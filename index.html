<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/imgs/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/imgs/32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/imgs/16.png">
  <link rel="mask-icon" href="/imgs/logo.png" color="#222">
  <meta name="google-site-verification" content="dJfRF5_6EbT_bJo2wTKbSXTDmNaOTqDGRDMcU6ylduk">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ghyghoo8.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"livere","storage":true,"lazyload":false,"nav":null,"activeClass":"livere"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="碎了一地...o(*￣︶￣*)o...">
<meta property="og:type" content="website">
<meta property="og:title" content="G8空间">
<meta property="og:url" content="https://ghyghoo8.github.io/index.html">
<meta property="og:site_name" content="G8空间">
<meta property="og:description" content="碎了一地...o(*￣︶￣*)o...">
<meta property="og:locale">
<meta property="article:author" content="ghyghoo8">
<meta property="article:tag" content="nodejs fe rust team">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://ghyghoo8.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>G8空间 - ghyghoo8的沉淀小碎</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7923526446101866" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.0/lib/sakana.min.css" /><style>#sakana-widget{position:fixed;bottom:0;left:0;}</style><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="G8空间" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">G8空间</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ghyghoo8的沉淀小碎</p>
      <a>
        <img class="custom-logo-image" src="/imgs/IMG_0001.PNG" alt="G8空间">
      </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook" rel="section"><i class="fa fa-comment fa-fw"></i>guestbook</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2doeWdob284" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2025/03/14/2025-03-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E8%87%AA%E5%BB%BASupabase%E6%9C%8D%E5%8A%A1-%E5%A2%99%E5%86%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/14/2025-03-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E8%87%AA%E5%BB%BASupabase%E6%9C%8D%E5%8A%A1-%E5%A2%99%E5%86%85/" class="post-title-link" itemprop="url">手把手自建Supabase服务-墙内</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2025-03-14T00:00:00+08:00">2025-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<p>Supabase作为开源的后端即服务（BaaS）平台，支持开发者快速构建应用，同时提供灵活的自建部署选项。</p>
<p><img src="/imgs/supa-1.png" alt="alt text"></p>
<p><img src="/imgs/supa-2.png" alt="alt text"></p>
<p>本文将基于官方Docker部署教程，结合实践经验，详细说明自部署流程与注意事项。</p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul>
<li>安装Docker与Docker Compose<br>确保系统已安装Docker及Docker Compose工具。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line">docker compose version</span><br></pre></td></tr></table></figure>

<ul>
<li><p>生成安全密钥<br>访问<span class="exturl" data-url="aHR0cHM6Ly9zdXBhYmFzZS5jb20vZG9jcy9ndWlkZXMvc2VsZi1ob3N0aW5nL2RvY2tlciNzZWN1cmluZy15b3VyLXNlcnZpY2Vz">Supabase密钥生成页面<i class="fa fa-external-link-alt"></i></span>，生成以下密钥并保存至安全位置：</p>
<ul>
<li><code>JWT_SECRET</code></li>
<li><code>ANON_KEY</code></li>
<li><code>SERVICE_ROLE_KEY</code></li>
</ul>
</li>
<li><p>部署步骤</p>
<ul>
<li>克隆Supabase代码库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth 1 https://github.com/supabase/supabase</span><br><span class="line"><span class="built_in">cd</span> supabase/docker</span><br></pre></td></tr></table></figure>
<ul>
<li>配置环境变量<br>复制示例配置文件并编辑, 将<em>生成安全密钥</em>步骤下生成的密钥，copy到<code>.env</code>文件中对应的位置。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> .env.example .<span class="built_in">env</span></span><br><span class="line">vi .<span class="built_in">env</span></span><br></pre></td></tr></table></figure>
<ul>
<li>拉取Docker镜像<br>这里推荐墙内镜像地址：<code>dytt.online</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose pull</span><br></pre></td></tr></table></figure>
<ul>
<li>​启动Supabase服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>
<p>服务启动后，通过docker compose ps检查容器状态，确认所有服务正常运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<ul>
<li>​访问管理界面<ul>
<li>​Studio：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDAw77yI6buY6K6k6LSm5Y+377yac3VwYWJhc2XvvIzlr4bnoIHop4EuZW525paH5Lu277yJ">http://localhost:8000（默认账号：supabase，密码见.env文件）<i class="fa fa-external-link-alt"></i></span></li>
<li>Logflare界面： <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo0MDAwLw==">http://localhost:4000<i class="fa fa-external-link-alt"></i></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="核心服务"><a href="#核心服务" class="headerlink" title="核心服务"></a>核心服务</h3><table>
<thead>
<tr>
<th>服务名称</th>
<th>功能描述</th>
<th>访问端口</th>
</tr>
</thead>
<tbody><tr>
<td><code>supabase-db</code></td>
<td>PostgreSQL数据库</td>
<td>5432</td>
</tr>
<tr>
<td><code>supabase-auth</code></td>
<td>用户身份认证</td>
<td>3000</td>
</tr>
<tr>
<td><code>supabase-studio</code></td>
<td>管理控制台</td>
<td>8000</td>
</tr>
<tr>
<td><code>supabase-analytics</code></td>
<td>Logflare控制台</td>
<td>4000</td>
</tr>
</tbody></table>
<h3 id="关闭与卸载"><a href="#关闭与卸载" class="headerlink" title="关闭与卸载"></a>关闭与卸载</h3><ul>
<li><strong>停止服务</strong></li>
</ul>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose down</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>彻底清理</strong></li>
</ul>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker system prune -a</span><br><span class="line"><span class="built_in">rm</span> -rf .supabase</span><br></pre></td></tr></table></figure>

<h3 id="一些常见问题"><a href="#一些常见问题" class="headerlink" title="一些常见问题"></a>一些常见问题</h3><ul>
<li><code>VAULT_ENC_KEY</code>字段长度问题：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29yZ3Mvc3VwYWJhc2UvZGlzY3Vzc2lvbnMvMzMxMTk=">https://github.com/orgs/supabase/discussions/33119<i class="fa fa-external-link-alt"></i></span><ul>
<li>必须32位，而不是<em>32-chars-min</em></li>
<li>已提交<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N1cGFiYXNlL3N1cGFiYXNlL3B1bGwvMzQxNzE=">issus<i class="fa fa-external-link-alt"></i></span></li>
</ul>
</li>
<li>如果<code>supabase-analytics</code>服务一直在重启，则查看容器日志。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs --details supabase-analytics</span><br></pre></td></tr></table></figure>
<p>若提示数据库账号密码验证失败，则需要进入<code>supabase-db</code>容器，给每个pgSQL账号设置密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it supabase-db /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器后</span></span><br><span class="line">psql -U postgres -W</span><br><span class="line"><span class="comment"># 输入默认密码，比如：postgres</span></span><br><span class="line"><span class="comment"># 进入后查看用户列表</span></span><br><span class="line">SELECT rolname,rolpassword FROM pg_authid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户密码</span></span><br><span class="line">ALTER USER supabase_admin WITH PASSWORD <span class="string">&#x27;postgres&#x27;</span>;</span><br><span class="line">ALTER USER supabase_auth_admin WITH PASSWORD <span class="string">&#x27;postgres&#x27;</span>;</span><br><span class="line">ALTER USER supabase_storage_admin WITH PASSWORD <span class="string">&#x27;postgres&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改完成后重启容器, 然后访问<code>http://localhost:8000</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose down</span><br><span class="line">docker compose up -d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="资料参考"><a href="#资料参考" class="headerlink" title="资料参考"></a>资料参考</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9zdXBhYmFzZS5jb20vZG9jcy9ndWlkZXMvc2VsZi1ob3N0aW5nL2RvY2tlcg==">官方教程: Self-Hosting with Docker<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpBNU56UTRPRGswTXc9PSZtaWQ9MjY1Mjc5Mjk2NCZpZHg9MSZzbj1kNzcyMDFmNzhhYWEzYWUzNzU0MmVhNTgwNzBiZTNhNyZjaGtzbT04YWNiNTcwYTIyMjg0YjYyNDdmMDRjOWE0MzI1YjI1OTVhZDBmMjcwM2NhZDdhZGZmMGJmNGU5YmVmOGRhOTA3YTE0ZDhhNzM3MDk3I3Jk">74.1k！Star分分钟搭建百万用户在线系统？Supabase 帮你轻松实现！<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpreE56STFOemcxTXc9PSZtaWQ9MjI0NzQ4NTQyMyZpZHg9MSZzbj1jZDU4MzU0NTA4YzYxNmY0NTQ2NmQ0OGI4NmIwOTkwNSZjaGtzbT1jMDI2ZWZhNzNlMTQ3N2RjNGViYzc4YTg5ZjQ2MmIzYzYxZjZlZGI4OTljYmY5ZDA2Yjc1MWViNDJlMWVhOTNkNGM5MmZiMjNhMGFhI3Jk">如何使用Docker配置和部署Supabase<i class="fa fa-external-link-alt"></i></span></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2025/03/13/2025-03-13-%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84docker%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/13/2025-03-13-%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84docker%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">awsome一些常用的docker命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-03-13 00:00:00" itemprop="dateCreated datePublished" datetime="2025-03-13T00:00:00+08:00">2025-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<ul>
<li>重置&amp;清理 docker容器和镜像</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 删除所有容器</span><br><span class="line">docker compose down</span><br><span class="line"></span><br><span class="line"># 重启</span><br><span class="line">docker compose restart</span><br><span class="line"></span><br><span class="line"># 真男人😂</span><br><span class="line">docker system prune -a</span><br><span class="line">sudo rm -rf docker/volumes/db/data</span><br><span class="line">docker compose up</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/09/12/2024-09-12-Linux%E4%B8%8B%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0UniVpn%E7%9A%84%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5&%E9%87%8D%E8%BF%9E%E4%BF%9D%E6%8C%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/12/2024-09-12-Linux%E4%B8%8B%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0UniVpn%E7%9A%84%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5&%E9%87%8D%E8%BF%9E%E4%BF%9D%E6%8C%81/" class="post-title-link" itemprop="url">Linux下如何实现UniVpn的自动连接/重连保持</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-12 00:00:00" itemprop="dateCreated datePublished" datetime="2024-09-12T00:00:00+08:00">2024-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<p>在使用 <span class="exturl" data-url="aHR0cHM6Ly93d3cubGVhZ3NvZnQuY29tL2RvYy9hcnRpY2xlLzEwMzE5Ny5odG1s">UniVpn<i class="fa fa-external-link-alt"></i></span> 进行 SSL VPN 连接时，为了确保网络连接的稳定性和可靠性，您可能需要启用自动重连功能。该功能可以在 VPN 连接意外中断时自动重新建立连接，从而减少因网络中断带来的不便。本文将介绍如何在 Linux 操作系统下，通过结合 <code>expect</code> 脚本和 <code>ping</code> 探测来实现自动重连功能。</p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>以 UniVpn 为例，我们将通过以下步骤实现自动重连：</p>
<h4 id="启动-VPN-客户端"><a href="#启动-VPN-客户端" class="headerlink" title="启动 VPN 客户端"></a>启动 VPN 客户端</h4><p>首先，在 shell 命令行中运行以下命令来启动 <code>UniVpn</code>，并创建一个 VPN 连接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/UniVPN/serviceclient/UniVPNCS</span><br></pre></td></tr></table></figure>

<h4 id="编写-expect-脚本"><a href="#编写-expect-脚本" class="headerlink" title="编写 expect 脚本"></a>编写 <code>expect</code> 脚本</h4><p>由于需要自动处理 VPN 连接，您需要安装 expect 程序。该工具能够自动化与命令行交互的操作。</p>
<p>安装 <code>expect</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install expect</span><br></pre></td></tr></table></figure>

<p>然后，编写一个 <code>expect</code> 脚本（例如 univpn_run.sh），用于监控并自动重连 VPN。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">expect &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">set timeout -1</span></span><br><span class="line"><span class="string">spawn /usr/local/UniVPN/serviceclient/UniVPNCS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 等待欢迎信息</span></span><br><span class="line"><span class="string">expect &quot;Welcome to UniVPN&quot;</span></span><br><span class="line"><span class="string">send &quot;3\r&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 等待连接选项</span></span><br><span class="line"><span class="string">expect &quot;*1:Connect*&quot;</span></span><br><span class="line"><span class="string">send &quot;1\r&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 等待连接成功提示</span></span><br><span class="line"><span class="string">expect &quot;*Please input the login user name*&quot;</span></span><br><span class="line"><span class="string">send &quot;[username]\r&quot;  #这里输入vpn用户名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 等待输入密码提示</span></span><br><span class="line"><span class="string">expect &quot;*Please input the login user password*&quot;</span></span><br><span class="line"><span class="string">send &quot;[password]\r&quot;  #这里输入vpn密码</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 等待最终连接成功提示</span></span><br><span class="line"><span class="string">expect &quot;*Connect Success,Enjoy*&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">spawn sh ./testping.sh   #这里是一个探测ping的代码</span></span><br><span class="line"><span class="string">expect &quot;*IP testing error*&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">send &quot;q\n&quot;</span></span><br><span class="line"><span class="string">expect &quot;*Logout succeeded.*&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="编写-ping-探测脚本"><a href="#编写-ping-探测脚本" class="headerlink" title="编写 ping 探测脚本"></a>编写 <code>ping</code> 探测脚本</h4><p>接下来，编写一个用于检测网络连通性的 <code>ping</code> 脚本（例如 testping.sh）。该脚本会定期检测 VPN 连接是否正常，若检测到连接中断，则会触发自动重连。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">            <span class="comment"># 要ping的IP地址  </span></span><br><span class="line">            IP_ADDRESS=<span class="string">&quot;xxx.xxx.xxx.xxx&quot;</span>  <span class="comment">#vpn连接上以后能ping通的一个ip</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 执行ping命令，检查IP地址是否可达  </span></span><br><span class="line">            ping -c 1 <span class="variable">$IP_ADDRESS</span> &gt; /dev/null 2&gt;&amp;1  </span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查ping命令的退出状态  </span></span><br><span class="line">            <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span>  </span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;IP testing success&quot;</span>    <span class="comment">#如果ping通了，输出</span></span><br><span class="line">            <span class="keyword">else</span>  </span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;IP testing error&quot;</span>   <span class="comment">#如果ping不通了，输出</span></span><br><span class="line">                    <span class="built_in">exit</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line"><span class="built_in">sleep</span> 20   <span class="comment">#每20秒ping一次</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="执行自动重连"><a href="#执行自动重连" class="headerlink" title="执行自动重连"></a>执行自动重连</h4><p>最后，执行以下命令运行自动重连脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x univpn_run.sh testping.sh &amp;  ./univpn_run.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>该脚本将持续检测网络状态，若 <code>ping</code> 不通，则会结束当前 VPN 连接并尝试重新连接。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>在多次连接后，可能会出现 VPN 无法正常连接的情况，这通常是由于网卡问题导致的。为解决这一问题，您可以编写一个脚本，在探测到网络故障后，自动重启网络服务。</p>
<p>此外，若重启网络服务后某些依赖网络的服务（如 Docker）出现问题，您可以在脚本中加入这些服务的重启命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># crontab设置： 30分钟执行一次检查</span></span><br><span class="line"><span class="comment"># */30 * * * * /root/dashboard/v2-web/docs/network_check.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标IP地址</span></span><br><span class="line">TARGET_IP=<span class="string">&quot;127.0.0.1&quot;</span>   <span class="comment">#这里换成你的IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ping命令连续ping指定次数（例如每10秒一次，共ping 3次）</span></span><br><span class="line">COUNT=1    <span class="comment">#这里探测多少次</span></span><br><span class="line">INTERVAL=10   <span class="comment">#这是每次探测的间隔时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ping命令进行测试</span></span><br><span class="line">RESULT=$(ping -c <span class="variable">$COUNT</span> -i <span class="variable">$INTERVAL</span> <span class="variable">$TARGET_IP</span> | grep <span class="string">&#x27;Destination Host Unreachable&#x27;</span>)    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果ping的结果包含&quot;Destination Host Unreachable&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$RESULT</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span> - Ping to <span class="variable">$TARGET_IP</span> failed. Restarting network service...&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 使用systemctl命令重启网络服务</span></span><br><span class="line">    systemctl restart network</span><br><span class="line">    <span class="comment">#systemctl restart docker    #这里是因为重启了network以后，docker的网络会出现问题，所以就重启一下docker。如果你有其他服务也可以这样重启一下。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h3 id="定时检测"><a href="#定时检测" class="headerlink" title="定时检测"></a>定时检测</h3><p>为了确保 VPN 的稳定性，您可以将上述脚本与定时任务（如 <code>cron</code>）结合，定期执行 <code>ping</code> 探测，确保在网络异常时及时恢复连接。</p>
<hr>
<p>通过上述步骤，您可以在 Linux 操作系统下实现 <code>UniVpn</code> 的自动重连功能，从而提升网络连接的稳定性和可靠性。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/07/10/2024-07-10-%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0CNN(%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/10/2024-07-10-%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%B9%A0CNN(%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C)/" class="post-title-link" itemprop="url">【译】快速学习CNN(卷积神经网络)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-07-10 00:00:00" itemprop="dateCreated datePublished" datetime="2024-07-10T00:00:00+08:00">2024-07-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/llm/" itemprop="url" rel="index"><span itemprop="name">llm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h2 id="CNN-是什么？"><a href="#CNN-是什么？" class="headerlink" title="CNN 是什么？"></a>CNN 是什么？</h2><p>在机器学习中，分类器将类标签分配给数据点。例如，图像分类器为图像中存在的对象产生一个类标签（例如鸟、飞机）。卷积神经网络（CNN）是一种类型的分类器，擅长解决这个问题！</p>
<p>CNN是一种神经网络：用于识别数据中的模式的算法。神经网络通常由一组神经元组成，这些神经元组织成层，每层都有自己可学习的权重和偏差。让我们将CNN分解为多个基本构建模块。</p>
<ol>
<li>一个<strong>张量</strong>可以被视为一个n维矩阵。在上述CNN中，张量将是三维的，除了输出层。</li>
<li>一个<strong>神经元</strong>可以被视为一个接受多个输入并产生单个输出的函数。神经元的输出在上面被表示为红色→蓝色的激活图。<br>一个层简单地是具有相同操作的神经元的集合，包括相同的超参数。</li>
<li>一个<strong>层</strong>简单地是具有相同操作的神经元的集合，包括相同的超参数。</li>
<li><strong>核权重和偏差</strong>，虽然对每个神经元都是独特的，但在训练阶段进行调整，并且允许分类器适应所提供的问题和数据集。它们在可视化中使用黄色→绿色的差异颜色刻度进行编码。具体的值可以通过点击神经元或悬停在卷积弹性解释视图中的<strong>核&#x2F;偏差</strong>上来查看交互式公式视图中的。</li>
<li>CNN表达了一个<strong>可微分的评分函数</strong>，这在输出层的可视化中表示为<strong>类别得分</strong>。</li>
</ol>
<p>如果您之前学习过神经网络，这些术语可能听起来很熟悉。那么CNN有何不同之处呢？CNN利用一种特殊类型的层，恰当地称为卷积层，使它们能够很好地学习图像和类似图像的数据。关于图像数据，CNN可用于许多不同的计算机视觉任务，<span class="exturl" data-url="aHR0cDovL2lqY3NpdC5jb20vZG9jcy9Wb2x1bWUlMjA3L3ZvbDdpc3N1ZTUvaWpjc2l0MjAxNjA3MDUwMTQucGRm">如图像处理、分类、分割和目标检测<i class="fa fa-external-link-alt"></i></span>。</p>
<p>在<span class="exturl" data-url="aHR0cHM6Ly9wb2xvY2x1Yi5naXRodWIuaW8vY25uLWV4cGxhaW5lci8=">CNN Explainer<i class="fa fa-external-link-alt"></i></span>中，您可以看到一个简单的CNN如何用于图像分类。由于网络的简单性，其性能并不完美，但这没关系！CNN Explainer中使用的网络架构Tiny VGG包含了如今最先进的CNN中使用的许多相同层和操作，但规模较小。这样，入门将会更容易理解。</p>
<h2 id="每个网络层都有什么作用？"><a href="#每个网络层都有什么作用？" class="headerlink" title="每个网络层都有什么作用？"></a>每个网络层都有什么作用？</h2><p>让我们逐层了解网络中的每一层。在阅读时，可以随意与<span class="exturl" data-url="aHR0cHM6Ly9wb2xvY2x1Yi5naXRodWIuaW8vY25uLWV4cGxhaW5lci8=">可视化工具-CNN Explainer<i class="fa fa-external-link-alt"></i></span>进行交互，点击和悬停在不同部分。</p>
<h3 id="输入层-Input-Layer"><a href="#输入层-Input-Layer" class="headerlink" title="输入层(Input Layer)"></a>输入层(Input Layer)</h3><p>输入层（最左边的层）代表CNN中的输入图像。因为我们使用RGB图像作为输入，输入层有三个通道，分别对应红色、绿色和蓝色通道，在这个层中显示。当您点击上面的网络详情图标<img src="https://poloclub.github.io/cnn-explainer/assets/figures/network_details.png" width="100">时，使用颜色标尺显示详细信息（在这一层和其他层上）。</p>
<h3 id="卷积层-Convolutional-Layers"><a href="#卷积层-Convolutional-Layers" class="headerlink" title="卷积层(Convolutional Layers)"></a>卷积层(Convolutional Layers)</h3><p>卷积层是CNN的基础，因为它们包含了学习到的卷积核（权重），这些卷积核可以提取出区分不同图像的特征，这正是我们进行分类所需要的！当您与卷积层交互时，您会注意到前一层和卷积层之间的联系。每个连接代表一个独特的卷积核，用于卷积操作以生成当前卷积神经元的输出或激活图。</p>
<p>卷积神经元执行一个逐元素的点积运算，使用一个独特的卷积核和前一层对应的神经元的输出。这将产生与独特卷积核数量相同的中间结果。卷积神经元是所有中间结果与学习到的偏置求和的结果。</p>
<p>例如，让我们看一下上面Tiny VGG架构中的第一个卷积层。注意这一层有10个神经元，但前一层只有3个神经元。在Tiny VGG架构中，卷积层是全连接的，意味着每个神经元与前一层的每个神经元都有连接。关注第一个卷积层中最上面的卷积神经元的输出，当我们悬停在激活图上时，我们可以看到有3个独特的卷积核。</p>
<p><img src="https://poloclub.github.io/cnn-explainer/assets/figures/convlayer_overview_demo.gif"><br><code>Figure 1. As you hover over the activation map of the topmost node from the first convolutional layer, you can see that 3 kernels were applied to yield this activation map. After clicking this activation map, you can see the convolution operation occuring with each unique kernel.</code></p>
<p>这些核的大小是由网络架构的设计者指定的超参数。为了产生卷积神经元（激活图）的输出，我们必须对上一层的输出和网络学习的唯一核进行逐元素点积运算。在TinyVGG中，点积运算使用1的步幅，这意味着每个点积中核都会移动1个像素，但这是网络架构设计者可以调整以更好地适应其数据集的超参数。我们必须对所有3个核执行此操作，这将产生3个中间结果。</p>
<p><img src="https://poloclub.github.io/cnn-explainer/assets/figures/convlayer_detailedview_demo.gif"><br><code>Figure 2. The kernel being applied to yield the topmost intermediate result for the discussed activation map.</code></p>
<p>然后，执行元素级求和，其中包含所有3个中间结果以及网络学习的偏差。之后，生成的二维张量将是在上述界面中查看的第一个卷积层中最顶层神经元的激活图。必须应用相同的操作来生成每个神经元的激活图。</p>
<p>通过一些简单的数学运算，我们可以推断出在第一个卷积层中有3 x 10 &#x3D; 30个独特的大小为3x3的卷积核。卷积层与前一层之间的连接是在构建网络架构时的设计决策，这将影响每个卷积层中的卷积核数量。</p>
<h3 id="了解超参数-Hyperparameters"><a href="#了解超参数-Hyperparameters" class="headerlink" title="了解超参数(Hyperparameters)"></a>了解超参数(Hyperparameters)</h3><p><img src="/imgs/a/models/c.jpg" alt="Hyperparameters"></p>
<ol>
<li><p><strong>填充(Padding)</strong> 通常在卷积核超出激活图时是必要的。填充可以保护激活图边缘的数据，提高性能，并有助于保持输入的空间大小，使架构设计师能够构建更深、性能更高的网络。存在许多填充技术，但最常用的方法是零填充，因为它具有性能好、简单和计算效率高的特点。该技术涉及在输入的边缘对称地添加零。这种方法被许多高性能的CNN（卷积神经网络）如AlexNet所采用。</p>
</li>
<li><p><strong>卷积核大小(Kernel size)</strong> ，通常也称为滤波器大小，指的是在输入上滑动窗口的尺寸。选择这个超参数对图像分类任务有巨大影响。例如，小卷积核尺寸能够从输入中提取包含高度局部特征的大量信息。正如您在上面的可视化中所看到的，较小的卷积核尺寸还导致层维度的减小，从而允许更深的架构。相反，大卷积核尺寸提取较少信息，导致层维度更快地减小，通常导致性能更差。大卷积核更适合提取较大的特征。最终，选择适当的卷积核大小将取决于您的任务和数据集，但一般来说，较小的卷积核大小能够提高图像分类任务的性能，因为架构设计者能够将更多层叠加在一起，以学习更复杂的特征！</p>
</li>
<li><p><strong>步幅(Stride)</strong> 表示卷积核每次应移动多少像素。例如，如上所述的卷积层示例中，Tiny VGG在其卷积层中使用步幅1，这意味着对输入的3x3窗口执行点积以产生输出值，然后每次后续操作都向右移动一个像素。步幅对CNN的影响类似于卷积核大小。随着步幅减小，学到的特征更多，因为提取更多数据，这也导致更大的输出层。相反，随着步幅增加，这导致特征提取受限，并且输出层尺寸更小。架构设计者的责任之一是确保在实现CNN时卷积核对输入进行对称滑动。使用上面的超参数可视化来改变各种输入&#x2F;卷积核维度上的步幅，以理解这个约束！</p>
</li>
</ol>
<h3 id="激活函数-Activation-Functions"><a href="#激活函数-Activation-Functions" class="headerlink" title="激活函数(Activation Functions)"></a>激活函数(Activation Functions)</h3><h4 id="ReLU"><a href="#ReLU" class="headerlink" title="ReLU"></a>ReLU</h4><p>神经网络在现代技术中非常普遍——因为它们非常准确！如今性能最高的CNN由大量层组成，能够学习更多特征。这些开创性的CNN能够实现如此巨大的准确性，部分原因是它们的非线性特性。ReLU将非线性引入模型中，这是非常必要的。非线性对于产生非线性决策边界是必要的，这样输出就不能被写成输入的线性组合。如果没有非线性激活函数，深度CNN架构将退化为一个等效的卷积层，性能远不如现在。ReLU激活函数被专门用作非线性激活函数，而不是其他非线性函数，比如Sigmoid，因为经验观察表明使用ReLU的CNN训练速度更快。</p>
<p>ReLU 激活函数是一种<code>one-to-one</code>的数学运算：<br><img src="https://poloclub.github.io/cnn-explainer/assets/figures/relu_graph.png"><br><code>Figure 3. The ReLU activation function graphed, which disregards all negative data.</code></p>
<p>该激活函数是对输入张量中的每个值逐元素应用的。例如，如果在值2.24上应用ReLU，则结果将是2.24，因为2.24大于0。您可以通过点击上面网络中的ReLU神经元来观察此激活函数的应用。在上述网络架构中的每个卷积层之后执行修正线性激活函数（ReLU）。注意此层对网络中各个神经元的激活图的影响！</p>
<h4 id="Softmax"><a href="#Softmax" class="headerlink" title="Softmax"></a>Softmax</h4><p><img src="/imgs/a/models/d.jpg" alt="Softmax"></p>
<p>一个softmax操作起到了关键作用：确保CNN的输出总和为1。因此，softmax操作对于将模型输出缩放为概率非常有用。单击最后一层可以看到网络中的softmax操作。注意，展开后的logits没有在0到1之间进行缩放。为了直观地显示每个logit（未缩放的标量值）的影响，它们使用浅橙色到深橙色的颜色比例进行编码。经过softmax函数处理后，每个类现在对应适当的概率！</p>
<p>也许你会想到标准归一化和softmax之间的区别——毕竟，它们都将logits重新缩放到0到1之间。请记住，反向传播是训练神经网络的关键方面——我们希望正确答案具有最大的“信号”。通过使用softmax，我们实际上是在“近似”argmax，同时获得了可微性。重新缩放不会使最大值比其他logits显著地更高，而softmax会。简而言之，softmax是一个“更柔和”的argmax。<br><img src="https://poloclub.github.io/cnn-explainer/assets/figures/softmax_animation.gif"><br><code>Figure 4. The Softmax Interactive Formula View allows a user to interact with both the color encoded logits and formula to understand how the prediction scores after the flatten layer are normalized to yield classification scores.</code></p>
<h3 id="池化层-Pooling-Layers"><a href="#池化层-Pooling-Layers" class="headerlink" title="池化层(Pooling Layers)"></a>池化层(Pooling Layers)</h3><p>不同的CNN架构中有许多种类型的池化层，但它们都旨在逐渐减少网络的空间范围，从而减少网络的参数和整体计算。上面的Tiny VGG架构中使用的池化类型是最大池化。</p>
<p>最大池化操作在架构设计过程中需要选择核大小和步幅长度。一旦选择了，该操作会在输入上滑动指定步幅的核，而仅选择每个核切片中的最大值，以产生输出的值。可以通过点击上面网络中的池化神经元来查看该过程。</p>
<p>在上述的Tiny VGG架构中，池化层使用2x2的核和步幅为2。这种具体规格的操作导致了75%的激活被丢弃。通过丢弃这么多数值，Tiny VGG更具计算效率，并避免过拟合。</p>
<h3 id="展平层-Flatten-Layer"><a href="#展平层-Flatten-Layer" class="headerlink" title="展平层(Flatten Layer)"></a>展平层(Flatten Layer)</h3><p>该层将网络中的三维层转换为一维向量，以适应用于分类的全连接层的输入。例如，一个5x5x2张量将被转换为大小为50的向量。网络的先前卷积层从输入图像中提取特征，但现在是对这些特征进行分类的时候了。我们使用softmax函数对这些特征进行分类，这需要一个一维输入。这就是为什么需要展平层。可以通过单击任何输出类来查看这一层。</p>
<h2 id="资料来源"><a href="#资料来源" class="headerlink" title="资料来源"></a>资料来源</h2><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9wb2xvY2x1Yi5naXRodWIuaW8vY25uLWV4cGxhaW5lci8=">https://poloclub.github.io/cnn-explainer/<i class="fa fa-external-link-alt"></i></span></li>
<li>视频教学</li>
</ul>
<iframe width="640" height="360" src="https://www.youtube.com/embed/HnWIHWFbuUQ" title="Demo Video &quot;CNN Explainer: Learning Convolutional Neural Networks with Interactive Visualization&quot;" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/06/07/2024-06-07-Hexo%E5%85%A8%E5%B1%80inject%E8%87%AA%E5%AE%9A%E4%B9%89JS%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/07/2024-06-07-Hexo%E5%85%A8%E5%B1%80inject%E8%87%AA%E5%AE%9A%E4%B9%89JS%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">Hexo全局Inject自定义JS脚本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-07 00:00:00" itemprop="dateCreated datePublished" datetime="2024-06-07T00:00:00+08:00">2024-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/theme/" itemprop="url" rel="index"><span itemprop="name">theme</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h3 id="在Hexo中注入JS脚本"><a href="#在Hexo中注入JS脚本" class="headerlink" title="在Hexo中注入JS脚本"></a>在Hexo中注入JS脚本</h3><hr>
<p>在撰写博客文章时，我们有时需要将JavaScript脚本添加到网页的头部，以便执行特定的功能或效果。</p>
<p>在Hexo中，通过使用injector API，你可以轻松地将自定义的JavaScript文件注入到生成的HTML文件中的 <code>&lt;head&gt;</code> 部分。以下是具体步骤：</p>
<h4 id="创建一个JavaScript文件"><a href="#创建一个JavaScript文件" class="headerlink" title="创建一个JavaScript文件"></a>创建一个JavaScript文件</h4><p>首先，在你的Hexo项目中创建一个新的JavaScript文件。例如，你可以在 <code>source/js</code> 目录下创建一个名为 <code>custom.js</code> 的文件。</p>
<h4 id="使用injector-API注入JavaScript文件"><a href="#使用injector-API注入JavaScript文件" class="headerlink" title="使用injector API注入JavaScript文件"></a>使用injector API注入JavaScript文件</h4><p>接下来，在Hexo的配置文件或插件中，使用injector API将JavaScript文件注入到 <code>&lt;head&gt;</code> 部分。以下是一个示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* global hexo */</span></span><br><span class="line"><span class="keyword">const</span> js = hexo.<span class="property">extend</span>.<span class="property">helper</span>.<span class="title function_">get</span>(<span class="string">&#x27;js&#x27;</span>).<span class="title function_">bind</span>(hexo);</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">injector</span>.<span class="title function_">register</span>(<span class="string">&#x27;head_end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">js</span>(<span class="string">&#x27;/js/custom.js&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上述代码将 <code>custom.js</code> 文件注入到每个生成的HTML文件的 <code>&lt;head&gt;</code> 部分的结束标签之前。</p>
<h4 id="确保JavaScript文件被正确引用"><a href="#确保JavaScript文件被正确引用" class="headerlink" title="确保JavaScript文件被正确引用"></a>确保JavaScript文件被正确引用</h4><p>确保你的 <code>custom.js</code> 文件路径正确，并且在Hexo生成的静态文件中可以找到。例如，如果你将 <code>custom.js</code> 文件放在 <code>source/js</code> 目录下，Hexo会自动将其复制到 <code>public/js</code> 目录。</p>
<h4 id="重新生成和部署网站"><a href="#重新生成和部署网站" class="headerlink" title="重新生成和部署网站"></a>重新生成和部署网站</h4><p>完成上述配置后，运行以下命令来重新生成并部署你的Hexo网站：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<p>这样，你的 <code>custom.js</code> 文件就会被注入到每个生成的HTML文件的 <code>&lt;head&gt;</code> 部分。</p>
<h3 id="在Hexo配置文件中使用injector"><a href="#在Hexo配置文件中使用injector" class="headerlink" title="在Hexo配置文件中使用injector"></a>在Hexo配置文件中使用injector</h3><p>在Hexo的配置文件中使用injector来注入代码片段是一个非常方便的功能。以下是详细步骤，教你如何在Hexo的配置文件中使用injector：</p>
<h4 id="步骤一：创建自定义代码文件"><a href="#步骤一：创建自定义代码文件" class="headerlink" title="步骤一：创建自定义代码文件"></a>步骤一：创建自定义代码文件</h4><p>首先，你需要创建一个你想要注入的代码文件。例如，你可以在 <code>source/js</code> 目录下创建一个名为 <code>custom.js</code> 的文件。</p>
<h4 id="步骤二：在Hexo配置文件中使用injector"><a href="#步骤二：在Hexo配置文件中使用injector" class="headerlink" title="步骤二：在Hexo配置文件中使用injector"></a>步骤二：在Hexo配置文件中使用injector</h4><p>在Hexo的主配置文件 <code>_config.yml</code> 中，你可以通过自定义插件或直接在Hexo入口文件中使用injector API来注入代码片段。</p>
<h4 id="方法一：直接在Hexo入口文件中使用"><a href="#方法一：直接在Hexo入口文件中使用" class="headerlink" title="方法一：直接在Hexo入口文件中使用"></a>方法一：直接在Hexo入口文件中使用</h4><p>你可以在Hexo项目的根目录下的 <code>index.js</code> 文件中添加以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* global hexo */</span></span><br><span class="line"><span class="keyword">const</span> js = hexo.<span class="property">extend</span>.<span class="property">helper</span>.<span class="title function_">get</span>(<span class="string">&#x27;js&#x27;</span>).<span class="title function_">bind</span>(hexo);</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">injector</span>.<span class="title function_">register</span>(<span class="string">&#x27;head_end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">js</span>(<span class="string">&#x27;/js/custom.js&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上述代码将 <code>custom.js</code> 文件注入到每个生成的HTML文件的 <code>&lt;head&gt;</code> 部分的结束标签之前。</p>
<h4 id="方法二：通过插件方式使用"><a href="#方法二：通过插件方式使用" class="headerlink" title="方法二：通过插件方式使用"></a>方法二：通过插件方式使用</h4><p>你也可以创建一个自定义插件来实现相同的功能。首先，在 <code>scripts</code> 目录下创建一个新的JavaScript文件，例如 <code>injector.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts/injector.js</span></span><br><span class="line"><span class="comment">/* global hexo */</span></span><br><span class="line"><span class="keyword">const</span> js = hexo.<span class="property">extend</span>.<span class="property">helper</span>.<span class="title function_">get</span>(<span class="string">&#x27;js&#x27;</span>).<span class="title function_">bind</span>(hexo);</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">injector</span>.<span class="title function_">register</span>(<span class="string">&#x27;head_end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">js</span>(<span class="string">&#x27;/js/custom.js&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后，在你的 <code>_config.yml</code> 文件中确保包含了 <code>scripts</code> 目录：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _config.yml</span></span><br><span class="line"><span class="attr">scripts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">scripts/injector.js</span></span><br></pre></td></tr></table></figure>

<h4 id="步骤三：重新生成和部署网站"><a href="#步骤三：重新生成和部署网站" class="headerlink" title="步骤三：重新生成和部署网站"></a>步骤三：重新生成和部署网站</h4><p>完成上述配置后，运行以下命令来重新生成并部署你的Hexo网站：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<p>这样，你的 <code>custom.js</code> 文件就会被注入到每个生成的HTML文件的 <code>&lt;head&gt;</code> 部分。</p>
<h3 id="使用injector-API中的不同位置"><a href="#使用injector-API中的不同位置" class="headerlink" title="使用injector API中的不同位置"></a>使用injector API中的不同位置</h3><p>通过这些步骤，你可以灵活地在Hexo的配置文件中使用injector来注入各种代码片段。injector API提供了多种注入位置，包括：</p>
<ul>
<li><code>head_end</code>：在 <code>&lt;head&gt;</code> 标签之前注入。</li>
<li><code>body_begin</code>：在 <code>&lt;body&gt;</code> 标签之后立即注入。</li>
<li><code>body_end</code>：在 <code>&lt;/body&gt;</code> 标签之前注入。</li>
</ul>
<p>例如，如果你想在 <code>&lt;body&gt;</code> 标签的结束标签之前注入代码，可以这样做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo.<span class="property">extend</span>.<span class="property">injector</span>.<span class="title function_">register</span>(<span class="string">&#x27;body_end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">js</span>(<span class="string">&#x27;/js/custom.js&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过这些步骤，你可以根据需要灵活地使用injector API来添加JavaScript脚本到你的Hexo网站。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/05/22/2024-05-22-Ollama%E5%AE%9A%E5%88%B6%E5%8C%96%E7%A7%81%E6%9C%89%E5%A4%A7%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/22/2024-05-22-Ollama%E5%AE%9A%E5%88%B6%E5%8C%96%E7%A7%81%E6%9C%89%E5%A4%A7%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">Ollama - 定制化私有大模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-22 00:00:00" itemprop="dateCreated datePublished" datetime="2024-05-22T00:00:00+08:00">2024-05-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/llm/" itemprop="url" rel="index"><span itemprop="name">llm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h3 id="拥有自己的私有大模型"><a href="#拥有自己的私有大模型" class="headerlink" title="拥有自己的私有大模型"></a>拥有自己的私有大模型</h3><p>在本教程中，我们将探索如何使用 Ollama 提供的 Modelfile 机制来定制自己的大型语言模型 (LLM)。我们将以 <code>llama3:8b</code> 为例，展示自定义过程。</p>
<h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p>今天，我将分享如何利用 Modelfile 创建新的模型或调整已有模型，以适应特定的应用场景。这包括内嵌自定义提示、修改上下文长度、温度、随机种子、减少废话程度以及增加或减少输出多样性等（这不是微调，只是调整模型原参数）。</p>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>在开始定制之前，您需要准备以下几点：</p>
<ol>
<li><p>安装 <a target="_blank" rel="noopener" href="https://ollama.com/download"><strong>Ollama</strong></a></p>
</li>
<li><p>下载并初始化一个新的模型版本：<code>ollama pull llama3:8b</code></p>
</li>
<li><p>确保能成功运行已下载的大语言模型：<code>ollama run llama3:8b</code></p>
</li>
</ol>
<h4 id="创建-Modelfile"><a href="#创建-Modelfile" class="headerlink" title="创建 Modelfile"></a>创建 Modelfile</h4><p>使用 <code>ollama show</code> 命令生成 Modelfile：<code>ollama show llama3:8b --modelfile &gt; myllama3.modelfile</code></p>
<p>Modelfile 的内容如下所示：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Modelfile generated by &quot;ollama show&quot;</span></span><br><span class="line"><span class="section"># To build a new Modelfile based on this, replace FROM with:</span></span><br><span class="line"><span class="section"># FROM llama3:latest</span></span><br><span class="line"></span><br><span class="line">FROM /Users/yourname/.ollama/models/blobs/sha256-00e1317cbf74d901080d7100f57580ba8dd8de57203072dc6f668324ba545f29</span><br><span class="line">TEMPLATE &quot;&#123;&#123; if .System &#125;&#125;&#123;&#123; .System&#125;&#125;&#123;&#123; end &#125;&#125;&quot;&#123;&#123; if .Prompt &#125;&#125;&#123;&#123; .Prompt&#125;&#125;&#123;&#123; end &#125;&#125;&quot;&#123;&#123; .Response &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">PARAMETER stop &quot;reserved<span class="emphasis">_special_</span>token&quot;</span><br><span class="line">LICENSE &quot;META LLAMA 3 COMMUNITY LICENSE AGREEMENT&quot;</span><br></pre></td></tr></table></figure>

<p>例举一些其他模型的modelfile模板:</p>
<ul>
<li>mixtral</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM /Users/user/data/ollama-file/models/MiniCPM-Llama3-V-2<span class="emphasis">_5/model/model-Q4_</span>K<span class="emphasis">_M.gguf</span></span><br><span class="line"><span class="emphasis">TEMPLATE [INST] &#123;&#123; if .System &#125;&#125;&#123;&#123; .System &#125;&#125; &#123;&#123; end &#125;&#125;&#123;&#123; .Prompt &#125;&#125; [/INST]</span></span><br><span class="line"><span class="emphasis">PARAMETER stop [INST]</span></span><br><span class="line"><span class="emphasis">PARAMETER stop [/INST]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">LICENSE &quot;&quot;&quot; Apache License  Version 2.0, January 2004 &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>llava</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FROM /Users/user/data/ollama-file/models/MiniCPM-Llama3-V-2_5/model/model-8B-F16.gguf</span><br><span class="line">TEMPLATE &quot;&lt;|im_start|&gt;system</span><br><span class="line">&#123;&#123; .System &#125;&#125;&lt;|im_end|&gt;</span><br><span class="line">&lt;|im_start|&gt;user</span><br><span class="line">&#123;&#123; .Prompt &#125;&#125;&lt;|im_end|&gt;</span><br><span class="line">&lt;|im_start|&gt;assistant</span><br><span class="line">&quot;</span><br><span class="line">PARAMETER stop &lt;|im_start|&gt;</span><br><span class="line">PARAMETER stop &lt;|im_end|&gt;</span><br><span class="line"></span><br><span class="line">LICENSE &quot;&quot;&quot; Apache License  Version 2.0, January 2004 &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>other</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM /Users/user/.ollama/models/blobs/sha256-eb569aba7d65cf3da1d0369610eb6869f4a53ee369992a804d5810a80e9fa035</span><br><span class="line">TEMPLATE &quot;&#123;&#123; if .System &#125;&#125;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</span><br><span class="line"></span><br><span class="line">&#123;&#123; .System &#125;&#125;&lt;|eot_id|&gt;&#123;&#123; end &#125;&#125;&#123;&#123; if .Prompt &#125;&#125;&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;</span><br><span class="line"></span><br><span class="line">&#123;&#123; .Prompt &#125;&#125;&lt;|eot_id|&gt;&#123;&#123; end &#125;&#125;&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</span><br><span class="line"></span><br><span class="line">&#123;&#123; .Response &#125;&#125;&lt;|eot_id|&gt;&quot;</span><br><span class="line">PARAMETER stop &lt;|start_header_id|&gt;</span><br><span class="line">PARAMETER stop &lt;|end_header_id|&gt;</span><br><span class="line">PARAMETER stop &lt;|eot_id|&gt;</span><br><span class="line">PARAMETER num_ctx 4096</span><br><span class="line">PARAMETER num_keep 4</span><br><span class="line">LICENSE &quot;&quot;&quot; Apache License  Version 2.0, January 2004 &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>




<h4 id="添加系统提示"><a href="#添加系统提示" class="headerlink" title="添加系统提示"></a>添加系统提示</h4><p>准备好您的系统提示（System Prompt），例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-----英文 Prompt Start------</span><br><span class="line"></span><br><span class="line">## Role and Goal:</span><br><span class="line"></span><br><span class="line">You are a scientific research paper reviewer, skilled in writing high-quality English scientific research papers. Your main task is to accurately and academically translate Chinese text into English, maintaining the style consistent with English scientific research papers. Users are instructed to input Chinese text directly, which will automatically initiate the translation process into English.</span><br><span class="line"></span><br><span class="line">## Constraints:</span><br><span class="line"></span><br><span class="line">Input is provided in Markdown format, and the output must also retain the original Markdown format.</span><br><span class="line">Familiarity with specific terminology translations is essential.</span><br><span class="line"></span><br><span class="line">## Guidelines:</span><br><span class="line">The translation process involves three steps, with each step&#x27;s results being printed:</span><br><span class="line">1. Translate the content directly from Chinese to English, maintaining the original format and not omitting any information.</span><br><span class="line">2. Identify specific issues in the direct translation, such as non-native English expressions, awkward phrasing, and ambiguous or difficult-to-understand parts. Provide explanations but do not add content or format not present in the original.</span><br><span class="line">3. Reinterpret the translation based on the direct translation and identified issues, ensuring the content remains true to the original while being more comprehensible and in line with English scientific research paper conventions.</span><br><span class="line"></span><br><span class="line">## Clarification:</span><br><span class="line"></span><br><span class="line">If necessary, ask for clarification on specific parts of the text to ensure accuracy in translation.</span><br><span class="line"></span><br><span class="line">## Personalization:</span><br><span class="line"></span><br><span class="line">Engage in a scholarly and formal tone, mirroring the style of academic papers, and provide translations that are academically rigorous.</span><br><span class="line"></span><br><span class="line">## Output format:</span><br><span class="line"></span><br><span class="line">Please output strictly in the following format</span><br><span class="line"></span><br><span class="line">### Direct Translation</span><br><span class="line">&#123;Placeholder&#125;</span><br><span class="line"></span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">### Identified Issues</span><br><span class="line">&#123;Placeholder&#125;</span><br><span class="line"></span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">### Reinterpreted Translation</span><br><span class="line">&#123;Placeholder&#125;</span><br><span class="line"></span><br><span class="line">Please translate the following content into English:</span><br><span class="line"></span><br><span class="line">-----英文 Prompt End------</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="创建新模型版本"><a href="#创建新模型版本" class="headerlink" title="创建新模型版本"></a>创建新模型版本</h4><p>执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama create myllama3 -f myllama3.modelfile</span><br></pre></td></tr></table></figure>
<p>完成后将显示 “success”。</p>
<p><img src="/imgs/a/models/a.jpg" alt="learn2"></p>
<h4 id="检查新建的模型版本"><a href="#检查新建的模型版本" class="headerlink" title="检查新建的模型版本"></a>检查新建的模型版本</h4><p>运行 <code>ollama ls</code>，查看是否已成功创建。</p>
<p><img src="/imgs/a/models/b.jpg" alt="learn2"></p>
<p>运行 <code>ollama run myllama3</code>，查看效果。</p>
<h5 id="如何引入新模型（HF转换成guff文件）"><a href="#如何引入新模型（HF转换成guff文件）" class="headerlink" title="如何引入新模型（HF转换成guff文件）"></a>如何引入新模型（HF转换成guff文件）</h5><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29sbGFtYS9vbGxhbWEvYmxvYi9tYWluL2RvY3MvaW1wb3J0Lm1k">Import a model<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dnZXJnYW5vdi9sbGFtYS5jcHA=">llama.cpp<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL09wZW5CTUIvbGxhbWEuY3BwL3RyZWUvbWluaWNwbS12Mi41L2V4YW1wbGVzL21pbmljcG12">llama定制化(minicpmv)<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h4 id="ModelFile模型文件描述"><a href="#ModelFile模型文件描述" class="headerlink" title="ModelFile模型文件描述"></a>ModelFile模型文件描述</h4><h5 id="指令参数"><a href="#指令参数" class="headerlink" title="指令参数"></a>指令参数</h5><table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>FROM (必填)</td>
<td>定义要使用的基本模型。</td>
</tr>
<tr>
<td>PARAMETER</td>
<td>设置 Ollama 如何运行模型的参数。</td>
</tr>
<tr>
<td>TEMPLATE</td>
<td>要发送到模型的完整提示模板。</td>
</tr>
<tr>
<td>SYSTEM</td>
<td>指定将在模板中设置的系统消息。</td>
</tr>
<tr>
<td>ADAPTER</td>
<td>定义要应用于模型的（Q）LoRA 适配器。</td>
</tr>
<tr>
<td>LICENSE</td>
<td>指定合法许可证。</td>
</tr>
<tr>
<td>MESSAGE</td>
<td>指定消息历史记录。</td>
</tr>
</tbody></table>
<h5 id="详细参数设置"><a href="#详细参数设置" class="headerlink" title="详细参数设置"></a>详细参数设置</h5><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
<th>值类型</th>
<th>用法示例</th>
</tr>
</thead>
<tbody><tr>
<td>mirostat</td>
<td>启用 Mirostat 采样以控制困惑度。（默认值：0、0  &#x3D; 禁用、1 &#x3D; 开启）</td>
<td>int</td>
<td><code>mirostat=1</code></td>
</tr>
<tr>
<td>mirostat_eta</td>
<td>影响算法对生成文本反馈的响应速度。较低的学习率将导致调整速度较慢，较高的学习率使算法更具响应性。（默认值：0.1）</td>
<td>float</td>
<td><code>mirostat_eta=0.2</code></td>
</tr>
<tr>
<td>mirostat_tau</td>
<td>控制输出的一致性和多样性的平衡。较低的值将导致文本更加集中连贯。（默认值：5.0）</td>
<td>float</td>
<td><code>mirostat_tau=4.0</code></td>
</tr>
<tr>
<td>num_ctx</td>
<td>设置用于生成下一个标记的上下文窗口大小。（默认值：2048）</td>
<td>int</td>
<td><code>num_ctx=4096</code></td>
</tr>
<tr>
<td>num_gqa</td>
<td>Transformer 层中 GQA 组数。某些型号需要，例如 llama2:70b 为 8</td>
<td>int</td>
<td><code>num_gqa=2</code></td>
</tr>
<tr>
<td>num_gpu</td>
<td>要发送到 GPU 的层数。在 macOS 上，默认为 1 开启金属支持，0 禁用。</td>
<td>int</td>
<td><code>num_gpu=1</code></td>
</tr>
<tr>
<td>num_thread</td>
<td>设置计算期间使用的线程数。默认情况下，Ollama 将检测到这一点以获得最佳性能。建议将此值设置为系统具有的物理 CPU 核心数（而不是逻辑核心数）。</td>
<td>int</td>
<td><code>num_thread=4</code></td>
</tr>
<tr>
<td>repeat_last_n</td>
<td>设置模型回溯多远以防止重复。（默认值：64，0 &#x3D; 禁用，-1 &#x3D; num_ctx）</td>
<td>int</td>
<td><code>repeat_last_n=32</code></td>
</tr>
<tr>
<td>repeat_penalty</td>
<td>设置惩罚重复的强度。较高的值（例如，1.5）将更强烈地惩罚重复，较低的值（例如，0.9）将更宽松。（默认值：1.1）</td>
<td>float</td>
<td><code>repeat_penalty=1.2</code></td>
</tr>
<tr>
<td>temperature</td>
<td>模型温度。提高温度将使模型答案更有创意。（默认值：0.8）这个值越低准确率越高。</td>
<td>float</td>
<td><code>temperature=0.9</code></td>
</tr>
<tr>
<td>seed</td>
<td>设置用于生成的随机数种子。将其设置为特定数字将使模型为相同的提示生成相同的文本。（默认值：0）</td>
<td>int</td>
<td><code>seed=42</code></td>
</tr>
<tr>
<td>stop</td>
<td>设置要使用的停止序列。当遇到这种模式时，LLM 将停止生成文本并返回。可以通过 stop 在模型文件中指定多个单独参数来设置多个停止模式。</td>
<td>string</td>
<td><code>stop=&quot;AI assistant:&quot;</code></td>
</tr>
<tr>
<td>tfs_z</td>
<td>无尾采样用于减少输出中不太可能的标记影响。较高的值（例如，2.0）将更多地减少影响，1.0 将禁用此设置。（默认值：1）</td>
<td>float</td>
<td><code>tfs_z=1.5</code></td>
</tr>
<tr>
<td>num_predict</td>
<td>生成文本时要预测的最大标记数。（默认值：128，-1 &#x3D; 无限生成，-2 &#x3D; 填充上下文）</td>
<td>int</td>
<td><code>num_predict=64</code></td>
</tr>
<tr>
<td>top_k</td>
<td>减少产生废话的可能性。较高的值（例如 100）将给出更多样化答案，较低的值（例如 10）将更加保守。（默认值：40）</td>
<td>int</td>
<td><code>top_k=30</code></td>
</tr>
<tr>
<td>top_p</td>
<td>与 top-k 一起工作。较高的值（例如，0.95）将导致更多样化文本，较低的值（例如，0.5）将生成更集中和保守文本。（默认值：0.9）</td>
<td>float</td>
<td><code>top_p=0.8</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/03/06/2024-03-06-ComfyUI-%E6%96%B0%E6%89%8B%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/06/2024-03-06-ComfyUI-%E6%96%B0%E6%89%8B%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">ComfyUI - 新手教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-06 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-06T00:00:00+08:00">2024-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/llm/" itemprop="url" rel="index"><span itemprop="name">llm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h3 id="ComfyUI新手教程：入门指南"><a href="#ComfyUI新手教程：入门指南" class="headerlink" title="ComfyUI新手教程：入门指南"></a>ComfyUI新手教程：入门指南</h3><h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p>欢迎来到ComfyUI的世界！ComfyUI是一个强大的图形界面工具，专为与深度学习模型协同工作而设计。在这个教程中，我们将引导你逐步了解ComfyUI的基础知识，并帮助你开始构建自己的创意工作流。在我们开始之前，让我们先探讨为什么你应该学习ComfyUI。</p>
<h4 id="为什么选择ComfyUI？"><a href="#为什么选择ComfyUI？" class="headerlink" title="为什么选择ComfyUI？"></a>为什么选择ComfyUI？</h4><p>市场上存在着各种类型的产品，它们大致可以分为两类：</p>
<ol>
<li><strong>融合型产品</strong>：如Midjourney、Stability AI等，它们将模型与产品紧密集成。</li>
<li><strong>分离型产品</strong>：如SD Web UI和ComfyUI，它们允许模型与用户界面分离。</li>
</ol>
<p>以下两类产品的优缺点对比：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>融合型产品</th>
<th>分离型产品</th>
</tr>
</thead>
<tbody><tr>
<td>学习成本</td>
<td>低，用户体验优化，提供教程。</td>
<td>高，开源性质，开发者众多，可能缺乏优化和教程。</td>
</tr>
<tr>
<td>迁移成本</td>
<td>高，需重新学习产品及模型知识。</td>
<td>低，只需学习模型知识。</td>
</tr>
<tr>
<td>自由度</td>
<td>低，封闭系统，功能有限。</td>
<td>高，开源，可自由修改和开发。</td>
</tr>
<tr>
<td>费用</td>
<td>高，通常需要付费使用。</td>
<td>中，提供本地版本，可自备GPU，无需额外费用。</td>
</tr>
</tbody></table>
<p>选择哪种产品取决于你的需求。如果你只是寻求娱乐，偶尔制作图片或视频，融合型产品可能是更好的选择。但如果你是专业人士，希望利用AI技术创造价值，分离型产品将为你提供更大的灵活性和控制权。</p>
<h4 id="学习ComfyUI的优势"><a href="#学习ComfyUI的优势" class="headerlink" title="学习ComfyUI的优势"></a>学习ComfyUI的优势</h4><ul>
<li><strong>迁移成本低</strong>：随着AI行业的快速发展，学会使用ComfyUI等分离型产品，可以让你轻松适应新的模型和技术，无需重新学习整个软件。</li>
<li><strong>高度自由度</strong>：ComfyUI允许你调整和优化AI模型，以适应你的工作流程，甚至可以开发新的功能。</li>
</ul>
<h4 id="SD-Web-UI与ComfyUI对比"><a href="#SD-Web-UI与ComfyUI对比" class="headerlink" title="SD Web UI与ComfyUI对比"></a>SD Web UI与ComfyUI对比</h4><p>为什么在众多分离型产品中选择ComfyUI？</p>
<ul>
<li><p><strong>用户界面</strong>：ComfyUI提供了一种独特的图形化工作流搭建方式，通过节点和连线的形式，使得工作流程更加直观和模块化。<br><img src="/imgs/ui/00001.png" alt="learn2"></p>
</li>
<li><p><strong>高度定制化</strong>：通过改变节点和连线，你可以轻松构建和调整工作流，以实现不同的功能。<br><img src="/imgs/ui/0000.png" alt="learn2"></p>
</li>
</ul>
<h4 id="开始使用ComfyUI"><a href="#开始使用ComfyUI" class="headerlink" title="开始使用ComfyUI"></a>开始使用ComfyUI</h4><p>在本教程中，我们将涵盖以下内容：</p>
<ol>
<li><strong>安装和设置</strong>：如何正确安装和配置ComfyUI环境。</li>
<li><strong>基础操作</strong>：了解ComfyUI界面，学习如何添加和连接节点。</li>
<li><strong>构建第一个工作流</strong>：通过一个简单的例子，学习如何构建一个基本的工作流。</li>
<li><strong>进阶技巧</strong>：探索如何自定义节点和优化工作流。</li>
</ol>
<p>准备好了吗？让我们开始你的ComfyUI之旅吧！</p>
<h2 id="开始入门"><a href="#开始入门" class="headerlink" title="开始入门"></a>开始入门</h2><p>以下是安装 ComfyUI 的大概步骤：</p>
<h3 id="本地安装方法"><a href="#本地安装方法" class="headerlink" title="本地安装方法"></a>本地安装方法</h3><h4 id="命令行安装"><a href="#命令行安装" class="headerlink" title="命令行安装"></a>命令行安装</h4><ol>
<li><p><strong>安装 pytorch</strong>：</p>
<ul>
<li>Windows 用户：使用 Miniconda3 安装 pytorch 的 nightly 版本。</li>
<li>Mac 用户：根据芯片类型下载 Miniconda3，然后安装 pytorch 的 nightly 版本。</li>
</ul>
</li>
<li><p><strong>下载 ComfyUI</strong>：</p>
<ul>
<li>使用 Git 命令 <code>git clone https://github.com/comfyanonymous/ComfyUI</code>。</li>
<li>或者使用 GitHub Desktop 客户端下载。</li>
</ul>
</li>
<li><p><strong>安装依赖</strong>：</p>
<ul>
<li>在 VS Code 中打开项目文件夹，在终端运行 <code>pip install -r requirements.txt</code>。</li>
<li>或者直接在 Terminal 中 cd 到项目文件夹，然后运行 <code>pip install -r requirements.txt</code>。</li>
</ul>
</li>
<li><p><strong>启动服务</strong>：</p>
<ul>
<li>在项目文件夹的终端中运行 <code>python main.py</code>。</li>
</ul>
</li>
</ol>
<h4 id="安装包安装"><a href="#安装包安装" class="headerlink" title="安装包安装"></a>安装包安装</h4><ol>
<li><p><strong>官方安装包</strong>：仅支持 Windows 系统，显卡必须是 Nivida。下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvbWZ5YW5vbnltb3VzL0NvbWZ5VUkvcmVsZWFzZXM=">ComfyUI 官方安装包<i class="fa fa-external-link-alt"></i></span>。</p>
</li>
<li><p><strong>Jupyter Notebook</strong>：要在paperspace、kaggle 或 colab 等服务上运行，可以使用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvbWZ5YW5vbnltb3VzL0NvbWZ5VUkvP3RhYj1yZWFkbWUtb3YtZmlsZSNqdXB5dGVyLW5vdGVib29r">Jupyter脚本<i class="fa fa-external-link-alt"></i></span>。</p>
</li>
<li><p><strong>Mac&#x2F;Linux</strong>：mac和linux环境，请移步官方的<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvbWZ5YW5vbnltb3VzL0NvbWZ5VUkvP3RhYj1yZWFkbWUtb3YtZmlsZSNvdGhlcnM=">安装指南<i class="fa fa-external-link-alt"></i></span></p>
</li>
</ol>
<h4 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h4><ul>
<li><strong>模块下载失败</strong>：配置终端代理。</li>
<li><strong>pyyaml 错误</strong>：运行 <code>pip install pyyaml</code>。</li>
</ul>
<p>完成安装后，打开浏览器输入 <code>http://127.0.0.1:8188/</code> 即可访问 ComfyUI。默认界面如下图，<br><img src="/imgs/ui/001.png" alt="learn2"></p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul>
<li>ComfyUI 的源码及官方安装教程👉<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvbWZ5YW5vbnltb3VzL0NvbWZ5VUk=">这里<i class="fa fa-external-link-alt"></i></span>。</li>
</ul>
<h3 id="下载-导入模型"><a href="#下载-导入模型" class="headerlink" title="下载 &amp; 导入模型"></a>下载 &amp; 导入模型</h3><p>安装完 ComfyUI 后，你需要下载对应的模型，并将模型导入到 ComfyUI 的 models 目录下。以下是详细步骤：</p>
<h4 id="不同-Stable-Diffusion-版本"><a href="#不同-Stable-Diffusion-版本" class="headerlink" title="不同 Stable Diffusion 版本"></a>不同 Stable Diffusion 版本</h4><ul>
<li><strong>Stable Diffusion v1.5</strong>：早期版本，许多 Lora 和 ContrlNet 模型基于它构建。<span class="exturl" data-url="aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9ydW53YXltbC9zdGFibGUtZGlmZnVzaW9uLXYxLTUvcmVzb2x2ZS9tYWluL3YxLTUtcHJ1bmVkLnNhZmV0ZW5zb3JzP2Rvd25sb2FkPXRydWU=">下载地址<i class="fa fa-external-link-alt"></i></span></li>
<li><strong>Stable Diffusion v2.0</strong>：重大更新，图像质量和速度提升，采用新的文本编码器 OpenCLIP。<span class="exturl" data-url="aHR0cHM6Ly9zdGFiaWxpdHkuYWkvYmxvZy9zdGFibGUtZGlmZnVzaW9uLXYyLXJlbGVhc2U=">release<i class="fa fa-external-link-alt"></i></span></li>
<li><strong>Stable Diffusion XL</strong>：最新版本，模型大小更大，生成更高质量的图像。<span class="exturl" data-url="aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9zdGFiaWxpdHlhaS9zdGFibGUtZGlmZnVzaW9uLXhsLWJhc2UtMS4wL3Jlc29sdmUvbWFpbi9zZF94bF9iYXNlXzEuMF8wLjl2YWUuc2FmZXRlbnNvcnM/ZG93bmxvYWQ9dHJ1ZQ==">下载地址<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h4 id="模型下载"><a href="#模型下载" class="headerlink" title="模型下载"></a>模型下载</h4><ol>
<li><strong>HuggingFace</strong>：搜索并下载模型，推荐下载 safetensors 格式的模型。</li>
<li><strong>CivitAI</strong>：搜索并下载模型，提供更多个人训练的模型。</li>
</ol>
<h4 id="模型导入"><a href="#模型导入" class="headerlink" title="模型导入"></a>模型导入</h4><ol>
<li><strong>未安装过 SD WebUI</strong>：下载模型后，将其放入 ComfyUI 的 models 目录下对应的文件夹。</li>
<li><strong>已安装 SD WebUI</strong>：修改 ComfyUI 中的 <code>extra_model_paths.yaml.example</code> 文件，将其改为 <code>extra_model_paths.yaml</code>，并配置 SD WebUI 的路径。</li>
</ol>
<p>完成模型导入后，ComfyUI 就可以加载并使用这些模型了。</p>
<h3 id="核心节点介绍"><a href="#核心节点介绍" class="headerlink" title="核心节点介绍"></a>核心节点介绍</h3><h4 id="高级节点"><a href="#高级节点" class="headerlink" title="高级节点"></a>高级节点</h4><h5 id="Diffusers-Loader"><a href="#Diffusers-Loader" class="headerlink" title="Diffusers Loader"></a>Diffusers Loader</h5><p>Diffusers Loader节点可以用于加载来自diffusers的扩散模型。</p>
<p>输入：model_path（指向diffusers模型的路径。）</p>
<p>输出：MODEL（用于对潜在变量进行降噪的模型）CLIP（用于对文本提示进行编码的CLIP模型。）</p>
<p>VAE（用于将图像编码至潜在空间，并从潜在空间解码图像的VAE模型。）</p>
<h5 id="Load-Checkpoin（with-config）【加载Checkpoint（带配置）节点】"><a href="#Load-Checkpoin（with-config）【加载Checkpoint（带配置）节点】" class="headerlink" title="Load Checkpoin（with config）【加载Checkpoint（带配置）节点】"></a>Load Checkpoin（with config）【加载Checkpoint（带配置）节点】</h5><p>“加载检查点（带配置）”节点可以根据提供的配置文件加载扩散模型。请注意，常规的加载检查点节点在大部分情况下能够推测出适当的配置。</p>
<p>输入：config_name（配置文件的名称）、ckpt_name（要加载的模型的名称）；</p>
<p>输出：MODEL（用于去噪潜在变量的模型）、CLIP（用于编码文本提示的CLIP模型）、VAE（用于将图像编码和解码到潜在空间的VAE模型。）</p>
<h5 id="VAE-解码（tiled）节点"><a href="#VAE-解码（tiled）节点" class="headerlink" title="VAE 解码（tiled）节点"></a>VAE 解码（tiled）节点</h5><p>VAE 解码（瓦片式）节点可用于将潜在空间图像解码回像素空间图像，使用提供的 VAE（变分自编码器）。该节点以瓦片的方式解码潜在图像，使其能够解码比常规 VAE 解码节点更大的潜在图像。</p>
<p>信息：当常规 VAE 解码节点由于 VRAM（视频随机存取存储器）不足而失败时，comfy（一种软件）将自动使用瓦片式实现进行重试。</p>
<p>输入参数为待解码的潜在图像和用于解码潜在图像的 VAE。输出结果是解码后的图像。</p>
<h5 id="VAE-编码（tiled）节点"><a href="#VAE-编码（tiled）节点" class="headerlink" title="VAE 编码（tiled）节点"></a>VAE 编码（tiled）节点</h5><p>VAE 编码（瓦片式）节点可用于将像素空间图像编码为潜在空间图像，使用提供的 VAE（变分自编码器）。该节点以瓦片的方式编码图像，使其能够编码比常规 VAE 编码节点更大的图像。</p>
<p>信息：当常规 VAE 编码节点由于 VRAM（视频随机存取存储器）不足而失败时，comfy将自动使用瓦片式实现进行重试。</p>
<p>输入参数为待编码的像素空间图像和用于编码像素图像的 VAE。输出结果是编码后的潜在图像。</p>
<h4 id="Conditioning（条件设定节点）"><a href="#Conditioning（条件设定节点）" class="headerlink" title="Conditioning（条件设定节点）"></a>Conditioning（条件设定节点）</h4><p>在 ComfyUI 中，Conditioning（条件设定）被用来引导扩散模型生成特定的输出。所有的Conditioning（条件设定）都开始于一个由 CLIP 进行嵌入编码的文本提示，这个过程使用了 Clip Text Encode 节点。这些条件可以通过本段中找到的其他节点进行进一步增强或修改。</p>
<p>例如，使用 Conditioning (Set Area)、Conditioning (Set Mask) 或 GLIGEN Textbox Apply 节点，可以引导过程朝着某种组合进行。</p>
<p>或者，通过 Apply Style Model、Apply ControlNet 或 unCLIP Conditioning 节点等，提供额外的视觉提示。相关节点的完整列表可以在侧边栏中找到。</p>
<h5 id="Apply-ControlNet（应用-ControlNet-节点）"><a href="#Apply-ControlNet（应用-ControlNet-节点）" class="headerlink" title="Apply ControlNet（应用 ControlNet 节点）"></a>Apply ControlNet（应用 ControlNet 节点）</h5><p>Apply ControlNet 节点能够为扩散模型提供更深层次的视觉引导。不同于 unCLIP 嵌入，controlnets 和 T2I 适配器能在任何模型上工作。通过联接多个节点，我们可以使用多个 controlNets 或 T2I 适配器来引导扩散模型。例如，通过提供一个包含边缘检测的图像和一个在边缘检测图像上训练的 controlNet，我们可以向扩散模型提示在最终图像中的边缘应该在哪里。</p>
<p>输入：包括conditioning（一个conditioning）、control_net（一个已经训练过的controlNet或T2IAdaptor，用来使用特定的图像数据来引导扩散模型）、image（用作扩散模型视觉引导的图像）。</p>
<p>输出：CONDITIONING，这是一个包含 control_net 和视觉引导的 Conditioning。</p>
<h5 id="应用样式模型节点（Apply-Style-Model-node）"><a href="#应用样式模型节点（Apply-Style-Model-node）" class="headerlink" title="应用样式模型节点（Apply Style Model node）"></a>应用样式模型节点（Apply Style Model node）</h5><p>应用风格模型节点可用于为扩散模型（diffusion model）提供进一步的视觉指导，特别是关于生成图像的风格。该节点接收一个T2I风格适配器（style adaptor）模型和一个CLIP视觉模型（CLIP vision model）的嵌入（embedding），以引导扩散模型朝向CLIP视觉模型嵌入的图像风格发展。</p>
<p>输入：包括条件（conditioning）、T2I风格适配器（style_model）、以及一个由CLIP视觉模型编码的包含期望风格的图像（CLIP_vision_output）。条件是一个特定的条件。T2I风格适配器是一个特定的模型，而CLIP视觉模型的输出是一个包含期望风格的图像。</p>
<p>输出：是一个包含T2I风格适配器和对期望风格的视觉指导的条件（CONDITIONING）。</p>
<h5 id="CLIP-设置最后一层节点-CLIP-Set-Last-Layer-Node"><a href="#CLIP-设置最后一层节点-CLIP-Set-Last-Layer-Node" class="headerlink" title="CLIP 设置最后一层节点 (CLIP Set Last Layer Node)"></a>CLIP 设置最后一层节点 (CLIP Set Last Layer Node)</h5><p>CLIP 设置最后一层节点 (CLIP Set Last Layer node) [1]用于设置从哪个 CLIP 输出层获取文本嵌入。文本被编码成嵌入的过程是通过 CLIP 模型的多层变换实现的。虽然传统的扩散模型通常根据 CLIP 的最后一层的输出进行条件设定，但有些扩散模型是基于早期层的条件设定的，如果使用最后一层的输出，可能效果不佳。</p>
<p>这个节点的输入 (inputs) 是用于编码文本的 CLIP 模型。输出 (outputs) 则是设置了新的输出层的 CLIP 模型。这样，我们可以根据需要，控制从哪一层获取文本嵌入，以适应不同的扩散模型条件。</p>
<h5 id="CLIP-文本编码-Prompt-节点-CLIP-Text-Encode-Prompt-Node"><a href="#CLIP-文本编码-Prompt-节点-CLIP-Text-Encode-Prompt-Node" class="headerlink" title="CLIP 文本编码 (Prompt) 节点 (CLIP Text Encode (Prompt) Node)"></a>CLIP 文本编码 (Prompt) 节点 (CLIP Text Encode (Prompt) Node)</h5><p>CLIP 文本编码 (Prompt) 节点可以使用 CLIP 模型将文本提示编码成嵌入，这个嵌入可以用来指导扩散模型生成特定的图片。关于 ComfyUI 中所有文本提示相关特性的完整指南，请参阅Text Prompts页面。</p>
<p>这个节点需要输入一个 CLIP 模型和一个需要被编码的文本。CLIP 模型用于将输入的文本转化为嵌入，而输入的文本则是你希望模型理解并生成相关图片的内容。经过这个节点处理后，你将得到一个包含嵌入文本的条件（Conditioning），这个条件用于指导扩散模型生成图片。</p>
<h5 id="CLIP-视觉编码节点-CLIP-Vision-Encode-Node"><a href="#CLIP-视觉编码节点-CLIP-Vision-Encode-Node" class="headerlink" title="CLIP 视觉编码节点 (CLIP Vision Encode Node)"></a>CLIP 视觉编码节点 (CLIP Vision Encode Node)</h5><p>CLIP 视觉编码节点用于使用 CLIP 视觉模型将图片编码成嵌入，这个嵌入可以用来指导 unCLIP 扩散模型，或者作为样式模型的输入。</p>
<p>这个节点的输入包括一个用于编码图片的 CLIP 视觉模型和一个需要被编码的图片。CLIP 视觉模型的任务就是将输入的图片转化为嵌入，而输入的图片则是你希望模型理解并进行处理的图像。经过这个节点处理后，将输出编码后的图片。</p>
<h5 id="平均调节-Conditioning-Average-节点"><a href="#平均调节-Conditioning-Average-节点" class="headerlink" title="平均调节 (Conditioning (Average)) 节点"></a>平均调节 (Conditioning (Average)) 节点</h5><p>平均调节节点可以根据在 conditioning_to_strength 中设置的强度因子，将两个文本嵌入值进行插值处理。</p>
<p>输入：参数包括 conditioning_to、conditioning_from 和 conditioning_to_strength。其中 conditioning_to 是在 conditioning_to_strength 为1时的调节文本嵌入值，conditioning_from 则是在 conditioning_to_strength 为0时的调节文本嵌入值。conditioning_to_strength 是用于控制将 conditioning_to 混入 conditioning_from 的混合因子。[2]</p>
<p>输出： CONDITIONING，这是一个新的调节文本嵌入值，它根据 conditioning_to_strength 的设定混合了输入的文本嵌入值。</p>
<h5 id="调节（合并）节点"><a href="#调节（合并）节点" class="headerlink" title="调节（合并）节点"></a>调节（合并）节点</h5><p>调节（合并）节点（Conditioning (Combine) node）可以通过平均扩散模型的预测噪声来合并多个调节。注意，这与调节（平均）节点（Conditioning (Average) node）是不同的。在这里，对不同调节的扩散模型输出（即构成调节的所有部分）进行平均，而调节（平均）节点则是在调节内部存储的文本嵌入之间进行插值。</p>
<p>输入包括第一个调节（conditioning_1）和第二个调节（conditioning_2）。输出为一个包含两个输入的新调节（CONDITIONING），稍后将由采样器进行平均。</p>
<h5 id="调节（设置区域）节点"><a href="#调节（设置区域）节点" class="headerlink" title="调节（设置区域）节点"></a>调节（设置区域）节点</h5><p>调节（设置区域）节点（Conditioning (Set Area) node）可以用来将调节限制在图像的指定区域内。结合调节（合并）节点（Conditioning (Combine) node），可以增加对最终图像构成的控制。</p>
<p>输入包括将被限制到一个区域的调节（conditioning），区域的宽度（width）、高度（height）、x坐标（x）、y坐标（y），以及在混合多个重叠调节时，要使用的区域的权重（strength）。输出为限制在指定区域的新调节（CONDITIONING）。</p>
<h5 id="调节（设置遮罩）节点"><a href="#调节（设置遮罩）节点" class="headerlink" title="调节（设置遮罩）节点"></a>调节（设置遮罩）节点</h5><p>调节（设置遮罩）节点（Conditioning (Set Mask) node）可以用来将调节限制在指定的遮罩内。结合调节（合并）节点（Conditioning (Combine) node），可以增加对最终图像构成的控制。</p>
<p>输入包括将被限制到遮罩的调节（conditioning），约束调节的遮罩（mask），以及在混合多个重叠调节时，要使用的遮罩区域的权重（strength）。还可以设置是否对整个区域进行去噪，或将其限制在遮罩的边界框内（set_cond_area）。输出为限制在指定遮罩内的新调节（CONDITIONING）。</p>
<h5 id="GLIGEN文本框应用节点"><a href="#GLIGEN文本框应用节点" class="headerlink" title="GLIGEN文本框应用节点"></a>GLIGEN文本框应用节点</h5><p>GLIGEN文本框应用节点（GLIGEN Textbox Apply node）可以用于为扩散模型提供更进一步的空间指导，引导它在图像的特定区域生成指定的提示部分。虽然文本输入会接受任何文本，但如果输入的是文本提示的一部分对象，GLIGEN的效果最好。</p>
<p>输入包括一个调节（conditioning_to）、一个CLIP模型（clip）、一个GLIGEN模型（gligen_textbox_model）、要关联空间信息的文本（text）、区域的宽度（width）、高度（height）、x坐标（x）和y坐标（y）。输出为包含GLIGEN和空间指导的调节（CONDITIONING）。</p>
<h5 id="unCLIP条件化节点-unCLIP-Conditioning-node"><a href="#unCLIP条件化节点-unCLIP-Conditioning-node" class="headerlink" title="unCLIP条件化节点 (unCLIP Conditioning node)"></a>unCLIP条件化节点 (unCLIP Conditioning node)</h5><p>unCLIP条件化节点 (unCLIP Conditioning node) 能够为unCLIP模型提供额外的视觉引导，通过由CLIP视觉模型编码的图像。这个节点可以串联起来，提供多张图像作为引导。</p>
<p>输入参数包括条件化 (conditioning)、由CLIP视觉模型编码的图像 (clip_vision_output)、unCLIP扩散模型应该受到图像多大的引导 (strength) 以及噪声增强 (noise_augmentation)。噪声增强可以用于引导unCLIP扩散模型随机地在原始CLIP视觉嵌入的邻域里移动，提供与编码图像密切相关的生成图像的额外变化。输出则是一种包含了unCLIP模型额外视觉引导的条件化 (CONDITIONING)。</p>
<h4 id="Image（图像）"><a href="#Image（图像）" class="headerlink" title="Image（图像）"></a>Image（图像）</h4><p>ComfyUI 提供了各种节点来操作像素图像。这些节点可以用于加载 img2img（图像到图像）工作流程的图像，保存结果，或者例如，为高分辨率工作流程放大图像。</p>
<h5 id="图像反转节点（Invert-Image）"><a href="#图像反转节点（Invert-Image）" class="headerlink" title="图像反转节点（Invert Image）"></a>图像反转节点（Invert Image）</h5><p>图像反转节点可以用来反转图像的颜色。</p>
<p>输入参数为待反转的像素图像。输出结果是反转后的像素图像。</p>
<h5 id="加载图像节点"><a href="#加载图像节点" class="headerlink" title="加载图像节点"></a>加载图像节点</h5><p>加载图像节点可用于加载图像。可以通过启动文件对话框或将图像拖放到节点上来上传图像。一旦图像被上传，它们可以在节点内部被选择。</p>
<p>信息：默认情况下，图像将被上传到 ComfyUI 的输入文件夹。</p>
<p>输入参数为待使用的图像名称。输出结果是像素图像和图像的 alpha 通道。</p>
<p>示例：为了执行图像到图像的生成，你需要使用加载图像节点来加载图像。在下面的例子中，一个图像是使用加载图像节点加载的，然后被一个 VAE 编码节点编码到潜在空间，让我们能够执行图像到图像的任务。<br><img src="/imgs/ui/img-0001.png" alt="learn2"></p>
<h5 id="“Pad-Image-for-Outpainting”（为外部绘画填充图像）节点"><a href="#“Pad-Image-for-Outpainting”（为外部绘画填充图像）节点" class="headerlink" title="“Pad Image for Outpainting”（为外部绘画填充图像）节点"></a>“Pad Image for Outpainting”（为外部绘画填充图像）节点</h5><p>“Pad Image for Outpainting”（为外部绘画填充图像）节点可用来为外部绘画的图像添加填充，然后将此图像通过”VAE Encode for Inpainting”（为内部绘画编码的变分自动编码器）传递给修复扩散模型。[8]</p>
<p>输入包括图像、左侧、上方、右侧、底部以及羽化。图像是需要被填充的图像。左侧、上方、右侧以及底部分别描述了图像各边需要填充的量。羽化则用于描述原始图像边缘的柔化程度。输出包括被填充的像素图像（IMAGE）和一个用于指示采样器在何处进行外部绘画的遮罩（MASK）。</p>
<h5 id="“Preview-Image”（预览图像）节点"><a href="#“Preview-Image”（预览图像）节点" class="headerlink" title="“Preview Image”（预览图像）节点"></a>“Preview Image”（预览图像）节点</h5><p>“Preview Image”（预览图像）节点可以用来在节点图内预览图像。输入是需要预览的像素图像。这个节点没有输出。</p>
<h5 id="“Save-Image”（保存图像）节点"><a href="#“Save-Image”（保存图像）节点" class="headerlink" title="“Save Image”（保存图像）节点"></a>“Save Image”（保存图像）节点</h5><p>“Save Image”（保存图像）节点可以用来保存图像。如果你只是想在节点图内预览图像，可以使用”Preview Image”（预览图像）节点。当你生成的图像过多，难以跟踪管理时，你可以通过一个带有文件前缀小部件的输出节点传递特殊格式的字符串来帮助组织你的图像。关于如何格式化你的字符串的更多信息，你可以查看Save File Formatting的相关内容。</p>
<p>输入包括需要预览的像素图像，以及一个要放入文件名中的前缀。这个节点没有输出。</p>
<h5 id="图像混合-Image-Blend-节点"><a href="#图像混合-Image-Blend-节点" class="headerlink" title="图像混合(Image Blend)节点"></a>图像混合(Image Blend)节点</h5><p>图像混合(Image Blend)节点用于将两个图像融合在一起。</p>
<p>输入参数包括第一个像素图像(image1)、第二个像素图像(image2)、第二个图像的透明度(blend_factor)及图像混合方式(blend_mode)。输出则是混合后的像素图像(IMAGE)。</p>
<h6 id="图像模糊-Image-Blur-节点"><a href="#图像模糊-Image-Blur-节点" class="headerlink" title="图像模糊(Image Blur)节点"></a>图像模糊(Image Blur)节点</h6><p>图像模糊(Image Blur)节点可以用来对图像应用高斯模糊(Gaussian blur)。</p>
<p>输入(inputs)包括图片(image)，这是需要被模糊化的像素图像，高斯半径(blur_radius)，以及高斯的西格玛(sigma)，西格玛越小，核就越集中在中心像素。输出(outputs)则是模糊化后的像素图像(IMAGE)。</p>
<h5 id="图像量化-Image-Quantize-节点"><a href="#图像量化-Image-Quantize-节点" class="headerlink" title="图像量化(Image Quantize)节点"></a>图像量化(Image Quantize)节点</h5><p>图像量化(Image Quantize)节点可以用来对图像进行量化处理，减少图像中的颜色数量。</p>
<p>输入(inputs)包括图片(image)，这是需要被量化的像素图像，颜色(colors)，即量化图像中的颜色数量，以及抖动(dither)，即是否使用抖动技术使量化图像看起来更平滑。输出(outputs)则是量化后的像素图像(IMAGE)。</p>
<h5 id="图像锐化-Image-Sharpen-节点"><a href="#图像锐化-Image-Sharpen-节点" class="headerlink" title="图像锐化(Image Sharpen)节点"></a>图像锐化(Image Sharpen)节点</h5><p>图像锐化(Image Sharpen)节点可以用来对图像应用拉普拉斯锐化滤波器(Laplacian sharpening filter)。</p>
<p>输入(inputs)包括图片(image)，即需要被锐化的像素图像，锐化半径(sharpen_radius)，即锐化核的半径，高斯西格玛(sigma)，西格玛越小，核就越集中在中心像素，以及锐化强度(alpha)，即锐化核的强度。输出(outputs)则是锐化后的像素图像(IMAGE)。</p>
<h5 id="使用模型放大图像-Upscale-Image-using-Model-节点"><a href="#使用模型放大图像-Upscale-Image-using-Model-节点" class="headerlink" title="使用模型放大图像(Upscale Image (using Model))节点"></a>使用模型放大图像(Upscale Image (using Model))节点</h5><p>使用模型放大图像(Upscale Image (using Model))节点可以用来通过加载放大模型(Load Upscale Model)节点中的模型来放大像素图像。</p>
<p>输入(inputs)包括用于放大的模型(upscale_model)和需要被放大的像素图像(image)。输出(outputs)则是放大后的图像(IMAGE)。</p>
<h4 id="潜在模型-Latent"><a href="#潜在模型-Latent" class="headerlink" title="潜在模型(Latent)"></a>潜在模型(Latent)</h4><p>像稳定扩散(Stable Diffusion)这样的潜在扩散模型并不在像素空间中操作，而是在潜在空间中进行去噪处理。这些节点提供了使用编码器和解码器在像素空间和潜在空间之间切换的方法，并提供了多种操控潜在图像的方式。</p>
<h5 id="空潜在图像-Empty-Latent-Image-节点"><a href="#空潜在图像-Empty-Latent-Image-节点" class="headerlink" title="空潜在图像(Empty Latent Image)节点"></a>空潜在图像(Empty Latent Image)节点</h5><p>空潜在图像(Empty Latent Image)节点可以用来创建一组新的空白潜在图像。这些潜在图像可以被例如在text2image工作流中通过采样器节点进行噪声处理和去噪后使用。</p>
<p>输入(inputs)包括潜在图像的像素宽度(width)和像素高度(height)，以及潜在图像的数量(batch_size)。输出(outputs)则是空白的潜在图像(LATENT)。</p>
<h5 id="潜在复合-Latent-Composite-节点"><a href="#潜在复合-Latent-Composite-节点" class="headerlink" title="潜在复合(Latent Composite)节点"></a>潜在复合(Latent Composite)节点</h5><p>潜在复合(Latent Composite)节点可以用来将一个潜在图像粘贴到另一个中。</p>
<p>输入(inputs)包括需要被粘贴的潜在图像(samples_to)，需要粘贴的潜在图像(samples_from)，粘贴潜在图像的x坐标(x)和y坐标(y)，以及需要粘贴的潜在图像的羽化程度(feather)。输出(outputs)则是一个包含了粘贴样本(samples_from)的新的潜在复合(LATENT)。</p>
<h5 id="潜在复合遮罩-Latent-Composite-Masked-节点"><a href="#潜在复合遮罩-Latent-Composite-Masked-节点" class="headerlink" title="潜在复合遮罩(Latent Composite Masked)节点"></a>潜在复合遮罩(Latent Composite Masked)节点</h5><p>潜在复合遮罩(Latent Composite Masked)节点可以用来将一个遮罩的潜在图像粘贴到另一个中。</p>
<p>信息(Info)：在ComfyUI中，坐标系统的原点位于左上角。</p>
<p>输入(inputs)包括需要被粘贴的潜在图像(destination)，需要粘贴的遮罩潜在图像(source)，遮罩(mask)，以及粘贴潜在图像的x坐标(x)和y坐标(y)。输出(outputs)则是一个包含了粘贴的源潜在图像(source)的新的潜在复合(LATENT)。</p>
<h5 id="放大潜在图像-Upscale-Latent-节点"><a href="#放大潜在图像-Upscale-Latent-节点" class="headerlink" title="放大潜在图像(Upscale Latent)节点"></a>放大潜在图像(Upscale Latent)节点</h5><p>放大潜在图像(Upscale Latent)节点可以用来调整潜在图像的大小。</p>
<p>警告(Warning):调整潜在图像的大小与调整像素图像的大小并不相同。直接调整潜在图像而不是像素可能会导致更多的图像失真。</p>
<p>输入(inputs)包括需要被放大的潜在图像(samples)，用于调整大小的方法(upscale_method)，目标像素宽度(Width)和目标像素高度(height)，以及是否通过中心裁剪(crop)图片以保持原始潜在图像的长宽比。输出(outputs)则是调整大小后的潜在图像(LATENT)。</p>
<h5 id="VAE解码-VAE-Decode-节点"><a href="#VAE解码-VAE-Decode-节点" class="headerlink" title="VAE解码(VAE Decode)节点"></a>VAE解码(VAE Decode)节点</h5><p>VAE解码(VAE Decode)节点可以用来将潜在空间图像解码回像素空间图像，解码过程使用提供的变分自编码器(VAE)。</p>
<p>输入(inputs)包括需要被解码的潜在图像(samples)以及用于解码潜在图像的变分自编码器(VAE)。输出(outputs)则是解码后的图像(IMAGE)。</p>
<h5 id="VAE编码-VAE-Encode-节点"><a href="#VAE编码-VAE-Encode-节点" class="headerlink" title="VAE编码(VAE Encode)节点"></a>VAE编码(VAE Encode)节点</h5><p>VAE编码(VAE Encode)节点可以用来将像素空间图像编码成潜在空间图像，编码过程使用提供的变分自编码器(VAE)。</p>
<p>输入(inputs)包括需要被编码的像素空间图像(pixels)和用于编码像素图像的变分自编码器(VAE)。输出(outputs)则是编码后的潜在图像(LATENT)。[9]</p>
<p>示例(example):为了在例如图像到图像的任务中使用图像，它们首先需要被编码成潜在空间。在下面的示例中，VAE编码节点被用来将一个像素图像转换成一个潜在图像，这样我们就可以对这个图像进行重新噪声处理和去噪，从而创造出新的图像。</p>
<h5 id="“Latent-From-Batch”节点"><a href="#“Latent-From-Batch”节点" class="headerlink" title="“Latent From Batch”节点"></a>“Latent From Batch”节点</h5><p>可以用于从一批潜在图像中提取一个切片。当需要在工作流中分离出特定的潜在图像或图像批次时，这将非常有用。</p>
<p>输入参数包括样本（samples，即要提取切片的一批潜在图像），批次索引（batch_index，即要提取的第一张潜在图像的索引），以及长度（length，即要取的潜在图像的数量）。输出结果是LATENT（新的只包含所选切片的潜在图像批次）。</p>
<h5 id="Rebatch-Latents节点"><a href="#Rebatch-Latents节点" class="headerlink" title="Rebatch Latents节点"></a>Rebatch Latents节点</h5><p>Rebatch Latents节点用于拆分或合并一批潜在图像的批次。当结果为多个批次时，该节点会输出一个批次列表，而不是单个批次。这在批次大小超过VRAM（视频随机存取内存）容量时非常有用，因为ComfyUI会按列表中的每个批次执行节点，而不是一次性执行。该节点也可用于将批次列表合并回单个批次。</p>
<p>输入与输出说明：输入”样本”是需要重新分批的潜在图像，”批大小”是新的批次大小。输出”LATENT”是一个潜在图像的列表，其中每个批次的大小不超过”批大小”。</p>
<h5 id="Repeat-Latent-Batch节点"><a href="#Repeat-Latent-Batch节点" class="headerlink" title="Repeat Latent Batch节点"></a>Repeat Latent Batch节点</h5><p>Repeat Latent Batch节点用于重复一批潜在图像。例如，这可以在图像到图像的工作流中用来创建图像的多个变体。</p>
<p>输入与输出说明：输入”样本”是要重复的潜在图像的批次，”数量”是重复的次数。输出”LATENT”是新的一批潜在图像，将原批次重复了设定的次数。</p>
<h5 id="【Inpaint】”Set-Latent-Noise-Mask”节点"><a href="#【Inpaint】”Set-Latent-Noise-Mask”节点" class="headerlink" title="【Inpaint】”Set Latent Noise Mask”节点"></a>【Inpaint】”Set Latent Noise Mask”节点</h5><p>可以用于为用于修复的潜在图像添加遮罩。设定噪声遮罩后，采样器节点只会在遮罩区域进行操作。如果提供了单一遮罩，批次中的所有潜在图像都会使用这个遮罩。</p>
<p>输入参数包括样本（samples，即待修复并添加遮罩的潜在图像），以及遮罩（mask，指示修复位置的遮罩）。输出结果是LATENT（经过遮罩处理的潜在图像）。</p>
<h5 id="【inpaint】”VAE-Encode-For-Inpainting”节点"><a href="#【inpaint】”VAE-Encode-For-Inpainting”节点" class="headerlink" title="【inpaint】”VAE Encode For Inpainting”节点"></a>【inpaint】”VAE Encode For Inpainting”节点</h5><p>“VAE Encode For Inpainting”节点可以使用所提供的变分自编码器（VAE）将像素空间的图像编码成潜在空间的图像，并接受一个用于修复的遮罩，向采样器节点指示应去噪的图像部分。通过<code>grow_mask_by</code>可以增加遮罩的区域，为修复过程提供一些额外的填充空间。</p>
<p>这个节点特别设计用于为修复训练的扩散模型，并确保编码前遮罩下的像素被设为灰色（0.5,0.5,0.5）。</p>
<p>输入参数包括像素（pixels，即待编码的像素空间图像），VAE（用于编码像素图像的变分自编码器），遮罩（mask，指示修复位置的遮罩），以及<code>grow_mask_by</code>（用于增加给定遮罩区域的量）。输出结果是LATENT（遮罩处理并编码后的潜在图像）。</p>
<h5 id="【Transform】”Crop-Latent”节点"><a href="#【Transform】”Crop-Latent”节点" class="headerlink" title="【Transform】”Crop Latent”节点"></a>【Transform】”Crop Latent”节点</h5><p>“Crop Latent”节点可以用来将潜在图像裁剪到新的形状。</p>
<p>输入参数包括样本（samples，即待裁剪的潜在图像），宽度（width，裁剪区域的像素宽度），高度（height，裁剪区域的像素高度），以及x和y（区域的像素坐标）。输出结果是LATENT（裁剪后的潜在图像）。</p>
<h5 id="【Transform】”Flip-Latent”节点"><a href="#【Transform】”Flip-Latent”节点" class="headerlink" title="【Transform】”Flip Latent”节点"></a>【Transform】”Flip Latent”节点</h5><p>“Flip Latent”节点可以用来将潜在图像进行水平翻转或垂直翻转。</p>
<p>输入参数包括样本（samples，即待翻转的潜在图像），以及翻转方法（flip_method，即是水平翻转还是垂直翻转）。输出结果是LATENT（翻转后的潜在图像）。</p>
<h5 id="【Transform】”Rotate-Latent”节点"><a href="#【Transform】”Rotate-Latent”节点" class="headerlink" title="【Transform】”Rotate Latent”节点"></a>【Transform】”Rotate Latent”节点</h5><p>“Rotate Latent”节点可以用于将潜在图像以90度的增量顺时针旋转。</p>
<p>输入参数包括样本（samples，即要旋转的潜在图像），以及旋转（rotation，指定顺时针旋转的角度）。输出结果是LATENT（旋转后的潜在图像）。</p>
<h4 id="Loaders，加载器"><a href="#Loaders，加载器" class="headerlink" title="Loaders，加载器"></a>Loaders，加载器</h4><p>本段中的加载器可以用来加载各种工作流中使用的模型。所有加载器的完整列表可以在侧边栏中找到。</p>
<h5 id="GLIGEN-Loader"><a href="#GLIGEN-Loader" class="headerlink" title="GLIGEN Loader"></a>GLIGEN Loader</h5><p>“GLIGEN Loader”[11]节点可以用于加载特定的GLIGEN模型。GLIGEN模型用于将空间信息关联到文本提示的部分，引导扩散模型按照GLIGEN指定的组合生成图像。</p>
<p>输入参数是GLIGEN模型的名称（gligen_name）。输出结果是GLIGEN模型（用于将空间信息编码到文本提示部分的模型）。</p>
<h5 id="Hypernetwork-Loader"><a href="#Hypernetwork-Loader" class="headerlink" title="Hypernetwork Loader"></a>Hypernetwork Loader</h5><p>Hypernetwork Loader 节点可用于加载超网络。与 LoRAs 类似，它们用于修改扩散模型，以改变潜在因素的去噪方式。典型的用例包括向模型添加生成某种风格的能力，或更好地生成某些主题或动作。甚至可以将多个超网络链接在一起以进一步修改模型。</p>
<p>提示：超网络强度值可以设置为负值。有时这可能会产生有趣的效果。</p>
<p>输入：</p>
<ul>
<li>model：一个扩散模型。</li>
<li>hypernetwork_name：超网络的名称。</li>
<li>strength：如何强烈地修改扩散模型。此值可以为负。</li>
</ul>
<p>输出：</p>
<ul>
<li>MODEL：修改后的扩散模型。</li>
</ul>
<h5 id="Load-CLIP"><a href="#Load-CLIP" class="headerlink" title="Load CLIP"></a>Load CLIP</h5><p>Load CLIP 节点可用于加载特定的 CLIP 模型。CLIP 模型用于编码指导扩散过程的文本提示。</p>
<p>警告：条件扩散模型是使用特定的 CLIP 模型进行训练的，使用与其训练时不同的模型不太可能产生好的图像。Load Checkpoint 节点会自动加载正确的 CLIP 模型。</p>
<p>输入：</p>
<ul>
<li>clip_name：CLIP 模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>CLIP：用于编码文本提示的 CLIP 模型。</li>
</ul>
<h5 id="Load-CLIP-Vision"><a href="#Load-CLIP-Vision" class="headerlink" title="Load CLIP Vision"></a>Load CLIP Vision</h5><p>Load CLIP Vision 节点可用于加载特定的 CLIP 视觉模型。与 CLIP 模型用于编码文本提示的方式类似，CLIP 视觉模型用于编码图像。</p>
<p>输入：</p>
<ul>
<li>clip_name：CLIP 视觉模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>CLIP_VISION：用于编码图像提示的 CLIP 视觉模型。</li>
</ul>
<h5 id="Load-Checkpoint"><a href="#Load-Checkpoint" class="headerlink" title="Load Checkpoint"></a>Load Checkpoint</h5><p>Load Checkpoint 节点可用于加载扩散模型，扩散模型用于去噪潜在因素。此节点还将提供适当的 VAE 和 CLIP 模型。</p>
<p>输入：</p>
<ul>
<li>ckpt_name：模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>MODEL：用于去噪潜在因素的模型。</li>
<li>CLIP：用于编码文本提示的 CLIP 模型。</li>
<li>VAE：用于将图像编码和解码到潜在空间的 VAE 模型。</li>
</ul>
<h5 id="Load-ControlNet-Model"><a href="#Load-ControlNet-Model" class="headerlink" title="Load ControlNet Model"></a>Load ControlNet Model</h5><p>Load ControlNet Model 节点可用于加载 ControlNet 模型。与 CLIP 模型提供一种给予文本提示以指导扩散模型的方式类似，ControlNet 模型用于为扩散模型提供视觉提示。这个过程与例如给扩散模型一个部分噪声的图像进行修改的方式不同。相反，ControlNet 模型可以用来告诉扩散模型例如最终图像中的边缘应该在哪里，或者主体应该如何摆放。此节点还可用于加载 T2IAdaptors。</p>
<p>输入：</p>
<ul>
<li>control_net_name：ControlNet 模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>CONTROL_NET：用于为扩散模型提供视觉提示的 ControlNet 或 T2IAdaptor 模型。</li>
</ul>
<h5 id="Load-LoRA"><a href="#Load-LoRA" class="headerlink" title="Load LoRA"></a>Load LoRA</h5><p>Load LoRA 节点可用于加载 LoRA。LoRAs 用于修改扩散和 CLIP 模型，以改变潜在因素的去噪方式。典型的用例包括向模型添加生成某种风格的能力，或更好地生成某些主题或动作。甚至可以将多个 LoRAs 链接在一起以进一步修改模型。</p>
<p>提示：LoRA 强度值可以设置为负值。有时这可能会产生有趣的效果。</p>
<p>输入：</p>
<ul>
<li>model：一个扩散模型。</li>
<li>clip：一个 CLIP 模型。</li>
<li>lora_name：LoRA 的名称。</li>
<li>strength_model：如何强烈地修改扩散模型。此值可以为负。</li>
<li>strength_clip：如何强烈地修改 CLIP 模型。此值可以为负。</li>
</ul>
<p>输出：</p>
<ul>
<li>MODEL：修改后的扩散模型。</li>
<li>CLIP：修改后的 CLIP 模型。</li>
</ul>
<h5 id="Load-Style-Model"><a href="#Load-Style-Model" class="headerlink" title="Load Style Model"></a>Load Style Model</h5><p>Load Style Model 节点可用于加载风格模型。风格模型可以用于为扩散模型提供关于去噪潜在因素应该采用的风格的视觉提示。</p>
<p>信息：目前只支持 T2IAdaptor 风格模型。</p>
<p>输入：</p>
<ul>
<li>style_model_name：风格模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>STYLE_MODEL：用于为扩散模型提供关于所需风格的视觉提示的风格模型。</li>
</ul>
<h5 id="Load-Upscale-Model"><a href="#Load-Upscale-Model" class="headerlink" title="Load Upscale Model"></a>Load Upscale Model</h5><p>Load Upscale Model 节点可用于加载特定的放大模型，放大模型用于放大图像。<br>输入：</p>
<ul>
<li>model_name：放大模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>UPSCALE_MODEL：用于放大图像的放大模型。</li>
</ul>
<h5 id="Load-VAE"><a href="#Load-VAE" class="headerlink" title="Load VAE"></a>Load VAE</h5><p>Load VAE 节点可用于加载特定的 VAE 模型。VAE 模型用于将图像编码和解码到潜在空间。尽管 Load Checkpoint 节点提供了一个 VAE 模型和扩散模型，但有时使用特定的 VAE 模型可能会很有用。</p>
<p>输入：</p>
<ul>
<li>vae_name：VAE 的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>VAE：用于将图像编码和解码到潜在空间的 VAE 模型。</li>
</ul>
<p>示例： 有时您可能希望使用与随节点加载的 VAE 不同的 VAE。我们使用不同的 VAE 将图像编码到潜在空间，并解码 Ksampler 的结果。</p>
<h5 id="unCLIP-Checkpoint-Loader"><a href="#unCLIP-Checkpoint-Loader" class="headerlink" title="unCLIP Checkpoint Loader"></a>unCLIP Checkpoint Loader</h5><p>unCLIP Checkpoint Loader 节点可用于加载专为与 unCLIP 一起工作而制作的扩散模型。unCLIP 扩散模型用于去噪潜在因素，这些潜在因素不仅基于提供的文本提示，还基于提供的图像。此节点还将提供适当的 VAE、CLIP 和 CLIP 视觉模型。</p>
<p>警告：尽管此节点可用于加载所有扩散模型，但并非所有扩散模型都与 unCLIP 兼容。</p>
<p>输入：</p>
<ul>
<li>ckpt_name：模型的名称。</li>
</ul>
<p>输出：</p>
<ul>
<li>MODEL：用于去噪潜在因素的模型。</li>
<li>CLIP：用于编码文本提示的 CLIP 模型。</li>
<li>VAE：用于将图像编码和解码到潜在空间的 VAE 模型。</li>
<li>CLIP_VISION：用于编码图像提示的 CLIP 视觉模型。</li>
</ul>
<h4 id="mask遮罩"><a href="#mask遮罩" class="headerlink" title="mask遮罩"></a>mask遮罩</h4><p>遮罩为采样器提供了一种方法，告诉它哪些部分应该去噪，哪些部分应该保持原样。这些节点提供了各种方法来创建或加载遮罩并对其进行操作。</p>
<h5 id="convert-image-to-mask"><a href="#convert-image-to-mask" class="headerlink" title="convert image to mask"></a>convert image to mask</h5><p>“Convert Image to Mask” 节点可以用来将图像的特定通道转换为遮罩。</p>
<p>输入：</p>
<ul>
<li>image：要转换为遮罩的像素图像。</li>
<li>channel：要用作遮罩的通道。</li>
</ul>
<p>输出：</p>
<ul>
<li>MASK：从图像通道创建的遮罩。</li>
</ul>
<h5 id="convert-mask-to-image"><a href="#convert-mask-to-image" class="headerlink" title="convert mask to image"></a>convert mask to image</h5><p>“Convert Mask to Image” 节点可以用来将遮罩转换为灰度图像。</p>
<p>输入：</p>
<ul>
<li>mask：要转换为图像的遮罩。</li>
</ul>
<p>输出：</p>
<ul>
<li>IMAGE：从遮罩生成的灰度图像。</li>
</ul>
<h5 id="crop-mask"><a href="#crop-mask" class="headerlink" title="crop mask"></a>crop mask</h5><p>“Crop Mask” 节点可以用来将遮罩裁剪成新的形状。<br>信息： ComfyUI 中的坐标系统原点位于左上角。</p>
<p>输入：</p>
<ul>
<li>mask：要裁剪的遮罩。</li>
<li>width：区域的像素宽度。</li>
<li>height：区域的像素高度。</li>
<li>x：区域的 x 坐标（以像素为单位）。</li>
<li>y：区域的 y 坐标（以像素为单位）。</li>
</ul>
<p>输出：</p>
<ul>
<li>MASK：裁剪后的遮罩。</li>
</ul>
<hr>
<p>参考：</p>
<ul>
<li>Comflowy - ComfyUI 社区：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY29tZmxvd3kuY29tL3poLUNO">https://www.comflowy.com/zh-CN<i class="fa fa-external-link-alt"></i></span></li>
<li>comfyUI节点介绍：<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NDgyNzg0ODE=">https://zhuanlan.zhihu.com/p/648278481<i class="fa fa-external-link-alt"></i></span></li>
<li>CLIP模型介绍(主要分Text Encoder和Image Encoder两个模块)：<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NjY2NjE2MjM=">https://zhuanlan.zhihu.com/p/666661623<i class="fa fa-external-link-alt"></i></span></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/02/20/2024-02-20-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/20/2024-02-20-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/" class="post-title-link" itemprop="url">深度学习和大模型的基础认知</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-02-20 00:00:00" itemprop="dateCreated datePublished" datetime="2024-02-20T00:00:00+08:00">2024-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/llm/" itemprop="url" rel="index"><span itemprop="name">llm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<p>在当今技术领域，大家谈论的时候常常涉及到“大模型”，对于很多新手来说，这个概念可能还比较模糊。为了让大家更好地参与讨论，让我们一起来了解一些关于深度学习和大模型的基础知识。</p>
<h2 id="什么是机器学习？"><a href="#什么是机器学习？" class="headerlink" title="什么是机器学习？"></a>什么是机器学习？</h2><p>机器学习简而言之，就是机器通过学习数据，自动找到一个函数。这个函数的作用是，给定输入，输出对应的预测结果。在数学上，这个函数可以表示为 <code>y = f(x)</code>，其中 <code>x</code> 是输入，<code>y</code> 是输出。比如，我们可以通过一个函数来预测摄入食物的卡路里，如 <code>卡路里 = 200 * 面包数量</code>。在机器学习领域，这个函数可能是一个包含上千亿参数的巨大函数，只有机器能够处理和理解。</p>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>模型（model）就是一个函数，而大模型则是一个巨大的函数。机器学习根据函数输出进行分类，包括回归、分类和生成式学习。</p>
<ul>
<li>回归（Regression）：函数的输出是一个数值，例如通过今天的 PM2.5、温度来预测明天的 PM2.5。</li>
<li>分类（Classification）：函数的输出是一个类别，比如判断一封邮件是否为垃圾邮件。</li>
<li>生成式学习（Generative Learning）：生成结构化文件，如影像、语音或文句。</li>
</ul>
<h2 id="什么是深度学习？"><a href="#什么是深度学习？" class="headerlink" title="什么是深度学习？"></a>什么是深度学习？</h2><p>深度学习是机器学习的一种，通过深层神经网络学习复杂的表示。以预测YouTube频道观看人数为例，最初的做法是使用线性函数 <code>Y=b+wX</code>。通过定义损失函数，并利用梯度下降方法，寻找最优参数 b 和 w 以使损失最小化。</p>
<h3 id="最原始做法"><a href="#最原始做法" class="headerlink" title="最原始做法"></a>最原始做法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义损失函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loss_function</span>(<span class="params">Y, predicted_Y</span>):</span><br><span class="line">    <span class="keyword">return</span> (Y - predicted_Y)**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化参数</span></span><br><span class="line">b = <span class="number">0</span></span><br><span class="line">w = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 学习率</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 迭代次数</span></span><br><span class="line">epochs = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 梯度下降迭代</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    <span class="comment"># 计算梯度</span></span><br><span class="line">    gradient_b = -<span class="number">2</span> * (Y - (b + w * X))</span><br><span class="line">    gradient_w = -<span class="number">2</span> * X * (Y - (b + w * X))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 更新参数</span></span><br><span class="line">    b = b - learning_rate * gradient_b</span><br><span class="line">    w = w - learning_rate * gradient_w</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练后的参数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b:&quot;</span>, b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;w:&quot;</span>, w)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但在测试数据上，这种简单线性模型的表现可能不佳。</p>
<h3 id="多看几天的数据"><a href="#多看几天的数据" class="headerlink" title="多看几天的数据"></a>多看几天的数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 使用前7天的数据</span><br><span class="line">X = [day1, day2, day3, day4, day5, day6, day7]</span><br><span class="line"></span><br><span class="line"># 其他步骤同上</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过引入更多天数的数据，如前 7 天的数据，我们得到更复杂的模型。逐渐增加参数量，可以提高预测效果，但存在过拟合的风险。</p>
<h3 id="线性模型太简单"><a href="#线性模型太简单" class="headerlink" title="线性模型太简单"></a>线性模型太简单</h3><p>线性函数模型（Linear Model 比如 Y&#x3D;b+wX）因为是直线，非常简单。不能模拟真实情况，真实的情况往往都不是简单线性关系，我们可以通过叠加多个sigmoid函数来达成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 使用多个 sigmoid 函数叠加</span><br><span class="line">def complex_model(X, parameters):</span><br><span class="line">    result = 0</span><br><span class="line">    for i in range(len(parameters)):</span><br><span class="line">        result += parameters[i] * sigmoid(X[i])</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"># 其他步骤同上</span><br></pre></td></tr></table></figure>

<h3 id="深度学习"><a href="#深度学习" class="headerlink" title="深度学习"></a>深度学习</h3><p>深度学习使用多个神经元(sigmoid函数)叠加的方式，构建更复杂的函数模型。神经网络中的每个 sigmoid 函数即为神经元，多层次的叠加构成深度学习模型。深度学习是对神经网络的发展，而不是直接模拟人类大脑。</p>
<p>在深度学习训练时，需要调整一些超参数：</p>
<ul>
<li>Batch size：对训练数据进行分批处理。</li>
<li>学习率：用于梯度下降，影响模型训练速度和精度。</li>
<li>神经元数量：影响函数复杂度，越多越复杂。</li>
<li>隐藏层数：层数越深，函数越复杂。</li>
</ul>
<p>深度学习的参数数量取决于神经元数量和隐藏层数，而大模型的参数量可能达到千亿级别。</p>
<h2 id="什么是LLM大语言模型？"><a href="#什么是LLM大语言模型？" class="headerlink" title="什么是LLM大语言模型？"></a>什么是LLM大语言模型？</h2><p>大语言模型（LLM）是基于海量文本数据训练的深度学习模型。它不仅能生成自然语言文本，还能深入理解文本含义，处理各种自然语言任务。参数量不断提升，使得模型能更细致地捕捉语言微妙之处。</p>
<h2 id="为什么大模型需要大量计算资源？"><a href="#为什么大模型需要大量计算资源？" class="headerlink" title="为什么大模型需要大量计算资源？"></a>为什么大模型需要大量计算资源？</h2><p>大模型的计算量可通过 FLOPS 进行估算，通常使用 GPU 进行训练。以 GPT-3 为例，其总算力需求与模型参数量、词数和单词运算量有关。对于训练和推理，计算量需求巨大，需要强大的计算资源，如数千张 GPU 卡。。</p>
<h3 id="跑一下大模型，感受下计算量"><a href="#跑一下大模型，感受下计算量" class="headerlink" title="跑一下大模型，感受下计算量"></a>跑一下大模型，感受下计算量</h3><p>通过示例代码，我们可以在本地实践一个大模型的运行，这里以 Microsoft 开源的 Phi-2 Transformer 模型为例。该模型有 27 亿参数，使用 96 张 A100-80G 的显卡训练 14 天完成。代码演示了加载模型和进行推理的过程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 示例代码（以Phi-2 Transformer为例）</span><br><span class="line">import torch</span><br><span class="line">from transformers import GPT2LMHeadModel, GPT2Tokenizer</span><br><span class="line"></span><br><span class="line"># 加载预训练模型和分词器</span><br><span class="line">model = GPT2LMHeadModel.from_pretrained(&quot;microsoft/philosopher-2.0-large&quot;)</span><br><span class="line">tokenizer = GPT2Tokenizer.from_pretrained(&quot;microsoft/philosopher-2.0-large&quot;)</span><br><span class="line"></span><br><span class="line"># 输入文本</span><br><span class="line">input_text = &quot;深度学习是&quot;</span><br><span class="line">input_ids = tokenizer.encode(input_text, return_tensors=&quot;pt&quot;)</span><br><span class="line"></span><br><span class="line"># 生成文本</span><br><span class="line">output = model.generate(input_ids, max_length=50, num_beams=5, no_repeat_ngram_size=2, top_k=50, top_p=0.95, temperature=0.7)</span><br><span class="line"></span><br><span class="line"># 解码并打印生成的文本</span><br><span class="line">decoded_output = tokenizer.decode(output[0], skip_special_tokens=True)</span><br><span class="line">print(decoded_output)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>参考：</p>
<ul>
<li>关于深度学习和大模型的基础认知： <span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvUTA3NDZJTUtOaVgwXzVFWEFQc05LQQ==">https://mp.weixin.qq.com/s/Q0746IMKNiX0_5EXAPsNKA<i class="fa fa-external-link-alt"></i></span></li>
<li>李宏毅深度学习课程：<span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1ZZTAxOHJDVnZPbw==">https://www.youtube.com/watch?v=Ye018rCVvOo<i class="fa fa-external-link-alt"></i></span></li>
<li>梯度下降：<span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9jN2U2NDI4NzdiMGU=">https://www.jianshu.com/p/c7e642877b0e<i class="fa fa-external-link-alt"></i></span></li>
<li>phi-2模型：<span class="exturl" data-url="aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9taWNyb3NvZnQvcGhpLTI=">https://huggingface.co/microsoft/phi-2<i class="fa fa-external-link-alt"></i></span></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2024/01/08/2024-01-08-%E6%8E%A2%E7%B4%A2RAG%E5%B7%A5%E7%A8%8B%EF%BC%9A%E5%BC%80%E5%90%AF%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E6%A3%80%E7%B4%A2%E7%9A%84%E9%9D%A9%E6%96%B0%E4%B9%8B%E6%97%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/08/2024-01-08-%E6%8E%A2%E7%B4%A2RAG%E5%B7%A5%E7%A8%8B%EF%BC%9A%E5%BC%80%E5%90%AF%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E6%A3%80%E7%B4%A2%E7%9A%84%E9%9D%A9%E6%96%B0%E4%B9%8B%E6%97%85/" class="post-title-link" itemprop="url">探索RAG工程：开启大规模语言模型与知识检索的革新之旅</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-08 00:00:00" itemprop="dateCreated datePublished" datetime="2024-01-08T00:00:00+08:00">2024-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/llm/" itemprop="url" rel="index"><span itemprop="name">llm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>在当今信息爆炸的时代，随着自然语言处理技术的不断发展，大规模语言模型已经成为了各个领域的核心工具。然而，由于计算成本的限制，这些模型在实际应用中仍存在一些挑战。为了解决这一问题，RAG工程应运而生，它将大规模语言模型与外部知识源相结合，为各种应用场景提供了更高效、准确的解决方案。本文将深入探讨RAG工程的原理、应用场景以及发展前景。</p>
<h3 id="RAG工程的应用场景"><a href="#RAG工程的应用场景" class="headerlink" title="RAG工程的应用场景"></a>RAG工程的应用场景</h3><p>RAG工程具有广泛的应用场景，其中最常见的是问答系统。通过将用户问题与知识库进行匹配和检索，RAG工程能够快速找到相关答案，并利用语言模型生成自然、流畅的回复。此外，RAG工程还可以应用于知识推理和文本生成等领域，例如在教育、医疗、金融等行业，为用户提供准确、高效的信息服务。</p>
<h3 id="RAG检索的原理"><a href="#RAG检索的原理" class="headerlink" title="RAG检索的原理"></a>RAG检索的原理</h3><p>RAG检索是RAG工程中的核心环节，它通过一系列步骤将用户问题与知识库中的内容进行匹配和筛选。具体来说，RAG检索包括理解问题、检索匹配、筛选排序和生成提示等步骤。首先，需要对用户问题进行语义理解和分析，以确定问题的主题和关键信息。然后，在知识库中进行相关内容的匹配和筛选，确保所选择的内容与问题高度相关。接下来，对检索到的内容进行筛选和排序，以排除不相关或低质量的文本。最后，基于筛选排序后的内容，生成提示给大规模语言模型，指导其生成高质量的回答。</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3RhcmRpcy96bS9hcnQvNDMzOTY1MTQ/c291cmNlX2lkPTEwMDM=">使用余弦相似度算法计算文本相似度<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="RAG中检索和生成的结合"><a href="#RAG中检索和生成的结合" class="headerlink" title="RAG中检索和生成的结合"></a>RAG中检索和生成的结合</h3><p>在RAG工程中，检索和生成是相互关联、相互影响的两个过程。检索过程为生成过程提供了相关的信息和提示，而生成过程则将检索结果转化为最终的回答形式。通过将两者相结合，可以充分发挥大规模语言模型的优势，同时降低计算成本和提高问答系统的准确率。在实际应用中，可以根据问题的类型和复杂程度，灵活地调整检索和生成的过程，以获得最佳的效果。</p>
<h3 id="RAG工程的发展前景"><a href="#RAG工程的发展前景" class="headerlink" title="RAG工程的发展前景"></a>RAG工程的发展前景</h3><p>随着自然语言处理技术的不断发展和大规模语言模型的广泛应用，RAG工程在未来具有广阔的发展前景。首先，随着技术的不断进步和应用需求的增加，RAG工程将在更多的领域得到应用。例如，在智能客服、教育、医疗等领域，RAG工程可以帮助提高问答系统的准确率和效率。此外，随着深度学习技术的不断发展，RAG工程中的检索和生成算法将不断优化和完善。例如，可以利用预训练语言模型提高生成的流畅性和自然度，同时利用先进的深度学习技术提高检索的准确性和效率。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>RAG工程是一种将大规模语言模型与外部知识源相结合的方法，为各种应用场景提供了更高效、准确的解决方案。随着技术的不断进步和应用需求的增加，RAG工程将在未来的发展中发挥越来越重要的作用。</p>
<h3 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9hcjVpdi5sYWJzLmFyeGl2Lm9yZy9odG1sLzIwMDUuMTE0MDE=">RAG论文原文<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9kb2NzL3RyYW5zZm9ybWVycy9tYWluL21vZGVsX2RvYy9yYWc=">RAG架构指南<i class="fa fa-external-link-alt"></i></span><br><img src="/imgs/a/rag-learn.jpg" alt="learn"><br><img src="/imgs/a/rag-2.jpg" alt="learn2"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://ghyghoo8.github.io/2023/12/26/2023-12-26-Ollama%20%E7%AE%80%E6%98%8E%E6%98%93%E7%94%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ghyghoo8">
      <meta itemprop="description" content="碎了一地...o(*￣︶￣*)o...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="G8空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/26/2023-12-26-Ollama%20%E7%AE%80%E6%98%8E%E6%98%93%E7%94%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">拥抱本地大模型：Ollama 简明易用指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-26 00:00:00" itemprop="dateCreated datePublished" datetime="2023-12-26T00:00:00+08:00">2023-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-15 15:37:17" itemprop="dateModified" datetime="2025-03-15T15:37:17+08:00">2025-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/llm/" itemprop="url" rel="index"><span itemprop="name">llm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>在过去的几个季度里，大语言模型（LLM）的平民化运动一直在快速发展，从最初的 Meta 发布 Llama 2 到如今，开源社区以不可阻挡之势适配、进化、落地。LLM已经从昂贵的GPU运行转变为可以在大多数消费级计算机上运行推理的应用，通称为本地大模型。</p>
<p>然而，本地大模型的推理需要相当大的显存，对于16位浮点精度（FP16）的模型，显存需求约为模型参数量的两倍。这使得运行大模型成为对普通家用计算机硬件规格的挑战。为了解决这个问题，模型量化技术应运而生，将权重参数的精度压缩为4位整数精度，大幅减小了显存需求。</p>
<p>在这一背景下，llama.cpp项目通过C&#x2F;C++重写了推理代码，避免了PyTorch引入的复杂依赖，并提供了更广泛的硬件支持，包括纯CPU推理、Apple Silicon等。然而，llama.cpp的使用仍然对用户有一定的门槛，需要获取模型权重、克隆项目代码、执行模型量化、设置环境变量等。</p>
<p>直到Ollama的出现，一个简明易用的本地大模型运行框架，为用户提供了更便捷的方式在个人电脑上运行大模型。</p>
<h3 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h3><p>Ollama的安装非常简单，macOS用户只需在官网下载安装包并运行，而Windows用户则可以通过WSL 2以Linux方式用命令进行安装。同时，熟悉Docker的用户也可以直接使用其官方镜像。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% curl https://ollama.ai/install.sh | sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>安装完成后，通过运行 ollama –version 命令检查版本，确认安装成功后即可通过 ollama pull 命令从在线模型库下载模型。例如，下载中文微调过的Llama2-Chinese 7B模型的4-bit量化版本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% ollama pull llama2-chinese</span><br></pre></td></tr></table></figure>

<p>下载完成后，使用 ollama run 命令即可运行模型并进行推理，支持单条输入或对话模式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 单条输入</span><br><span class="line">% ollama run llama2-chinese &quot;天空为什么是蓝色的？&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 对话模式</span><br><span class="line">% ollama run llama2-chinese</span><br><span class="line">&gt;&gt;&gt; /?</span><br><span class="line">Available Commands:</span><br><span class="line">  /set         Set session variables</span><br><span class="line">  /show        Show model information</span><br><span class="line">  /bye         Exit</span><br><span class="line">  /?, /help    Help for a command</span><br><span class="line"></span><br><span class="line">Use &quot;&quot;&quot; to begin a multi-line message.</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 天空为什么是蓝色的？</span><br><span class="line"></span><br><span class="line">这个问题是一个常见的争议。有一些科学家认为天空的蓝色可以被解释为雾和云层中的微小碎片反射出来的光色，而其他人则认为这是由于地球自身温度的影响。目前还没这个问题是一个常见的争议。有一些科学家认为天空的蓝色可以被解释为雾和云层中的微小碎片反射出来的光色，而其他人则认为这是由于地球自身温度的影响。目前还没有一个公认的解释。</span><br></pre></td></tr></table></figure>


<h3 id="套壳玩法"><a href="#套壳玩法" class="headerlink" title="套壳玩法"></a>套壳玩法</h3><p>尽管Ollama为用户带来了便利，但命令行形式仍然对一些用户来说不够友好。为此，Ollama提供了一系列周边工具，包括Web界面、桌面应用、终端工具等。其中，Ollama GUI的选择多样，包括Web版本、终端TUI版本（oterm）以及Raycast插件等，以满足用户不同的使用偏好。<br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ptb3JnYW5jYS9vbGxhbWE/dGFiPXJlYWRtZS1vdi1maWxlI2NvbW11bml0eS1pbnRlZ3JhdGlvbnM=">传送门<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="进阶玩法"><a href="#进阶玩法" class="headerlink" title="进阶玩法"></a>进阶玩法</h3><h4 id="更换模型"><a href="#更换模型" class="headerlink" title="更换模型"></a>更换模型</h4><p>Ollama支持用户自定义系统提示词和调整推理温度等参数。用户可以根据自己的需求选择不同版本的模型，如13B版本，只需在命令中添加对应标签：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">% ollama run llama2-chinese:13b &quot;天空为什么是蓝色的？&quot;</span><br><span class="line"></span><br><span class="line">天空是由大气层和太阳光的散射而成的蓝色。</span><br><span class="line"></span><br><span class="line">在日出之前，我们看到的天空是紫色或彩虹色，这是因为太阳光从海平面反射回来时，会被大气中的二氧化碳和水分子散射成蓝色、紫色或彩虹色。</span><br><span class="line"></span><br><span class="line">而在日出之后，天空变成了灰色，这是由于太阳光从大气中被阻挡，并且不再有足够的反射来给天空增加蓝色。</span><br><span class="line"></span><br><span class="line">当我们看到天空时，它的颜色是由于太阳光与大气中的物质相互作用而形成的。这些物质包括水、二氧化碳和其他气体，以及微小的冰片和沙塵。</span><br><span class="line"></span><br><span class="line">当我们看到天空变成了晚上时，天空会逐渐变得更加深蓝，这是由于太阳光在大气中传播，同时也因为大气层的结构。</span><br></pre></td></tr></table></figure>


<h4 id="图片支持"><a href="#图片支持" class="headerlink" title="图片支持"></a>图片支持</h4><p>除了纯语言大模型，Ollama还从0.1.15版本开始提供了对视觉模型的支持。用户只需在提示中添加本地图片路径即可进行图像文本推理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% ollama run llava</span><br><span class="line">&gt;&gt;&gt; What does the text in this image say? /Users/mchiang/Downloads/image.png </span><br><span class="line">Added image &#x27;/Users/mchiang/Downloads/image.png&#x27;</span><br><span class="line"></span><br><span class="line">The text in this image says &quot;The Ollamas.&quot;</span><br></pre></td></tr></table></figure>

<h4 id="自定义系统提示词"><a href="#自定义系统提示词" class="headerlink" title="自定义系统提示词"></a>自定义系统提示词</h4><p>Ollama允许用户自定义系统提示词，提高模型的个性化。用户可以通过前端工具或直接调用API传入系统提示词选项进行配置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:11434/api/chat -d &#x27;&#123;</span><br><span class="line">  &quot;model&quot;: &quot;llama2-chinese:13b&quot;,</span><br><span class="line">  &quot;messages&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;role&quot;: &quot;system&quot;,</span><br><span class="line">      &quot;content&quot;: &quot;以海盗的口吻简单作答。&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">      &quot;content&quot;: &quot;天空为什么是蓝色的？&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;stream&quot;: false</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>


<h4 id="更多选项"><a href="#更多选项" class="headerlink" title="更多选项"></a>更多选项</h4><p>Ollama的ModelFile提供了更多自定义的空间，包括系统提示词、对话模板、模型推理温度、上下文窗口长度等参数均可自行设置，适合进阶使用者。</p>
<p>在创建前，通过 <code>show --modelfile</code> 命令可以查看现有模型的 ModelFile 内容，作为参考：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">% ollama show --modelfile llama2-chinese:13b</span><br><span class="line"># Modelfile generated by &quot;ollama show&quot;</span><br><span class="line"># To build a new Modelfile based on this one, replace the FROM line with:</span><br><span class="line"># FROM llama2-chinese:13b</span><br><span class="line"></span><br><span class="line">FROM ~/.ollama/models/blobs/sha256:8359bebea988186aa6a947d55d67941fede5044d02e0ab2078f5cc0dcf357831</span><br><span class="line">TEMPLATE &quot;&quot;&quot;&#123;&#123; .System &#125;&#125;</span><br><span class="line">Name: &#123;&#123; .Prompt &#125;&#125;</span><br><span class="line">Assistant:</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">PARAMETER stop &quot;Name:&quot;</span><br><span class="line">PARAMETER stop &quot;Assistant:&quot;</span><br></pre></td></tr></table></figure>
<p>以自定义系统提示词并修改推理温度参数为例，应构建如下格式的 ModelFile：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM llama2-chinese:13b</span><br><span class="line"></span><br><span class="line">SYSTEM &quot;以海盗的口吻作答。&quot;</span><br><span class="line">PARAMETER temperature 0.1</span><br></pre></td></tr></table></figure>
<p>然后使用 create 命令进行创建，新的模型会沿用原有模型的权重文件和未作调整的选项参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama create llama2-chinese-pirate -f ~/path/to/ModelFile</span><br></pre></td></tr></table></figure>
<p>从而得到了属于自己的本地模型。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>Ollama的出现使得本地大模型的运行变得更加简单快捷。尽管相较于普通应用软件，Ollama的使用体验可能仍有提升空间，但与数月前相比，其进步巨大。称Ollama为AI技术平民化的贡献并不为过，它为更多人以最简单快速的方式在本地运行大模型提供了可能。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ghyghoo8</p>
  <div class="site-description" itemprop="description">碎了一地...o(*￣︶￣*)o...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ghyghoo8</span>
</div>
  <div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9waXNjZXMudGhlbWUtbmV4dC5vcmc=">NexT.Pisces</span>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<!-- hexo injector body_end start -->
<script src="/js/bot.js"></script>
<div id="sakana-widget"></div><script>
      function initSakanaWidget() {
        // 默认自走模式
        new SakanaWidget().mount('#sakana-widget').triggetAutoMode();
      }
    </script><script
      async
      onload="initSakanaWidget()"
      src="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.0/lib/sakana.min.js"
    ></script><!-- hexo injector body_end end --></body>
</html>
